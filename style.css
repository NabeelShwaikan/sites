/* Google Font */
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap');

/* ========================= CSS VARIABLES ========================= */
:root{
  --bg:#f8fafc; --fg:#0f172a; --muted:#64748b;
  --card:#ffffff; --b:#e5e7eb;
  --acc:#0ea5e9; --acc2:#0369a1;
  --chip:#f1f5f9;
  --radius:18px;
  --shadow:0 8px 24px rgba(2,6,23,.06);

  /* للدعم العام */
  --panel: var(--card);
  --text: var(--fg);

  /* تباين المودال (فاتح) */
  --modal-overlay: rgba(0,0,0,.58);
  --dialog-bg: #ffffff;
  --dialog-border: #e5e7eb;
  --dialog-shadow: 0 22px 60px rgba(0,0,0,.32), 0 8px 24px rgba(0,0,0,.18);
}

[data-theme="dark"]{
  --bg:#0b1220; --fg:#e5e7eb; --muted:#94a3b8;
  --card:#0f172a; --b:#1f2937;
  --acc:#38bdf8; --acc2:#0284c7;
  --chip:#111827;
  --shadow:0 14px 36px rgba(0,0,0,.35);
  --panel:#0f172a;
  --text:#e5e7eb;

  /* تباين المودال (داكن) */
  --modal-overlay: rgba(0,0,0,.78);
  --dialog-bg:#162236;          /* أفتح من الخلفية العامة ليبرز المودال */
  --dialog-border:#385074;       /* حدود أوضح */
  --dialog-shadow: 0 28px 70px rgba(0,0,0,.70), 0 10px 36px rgba(0,0,0,.55);
}

[data-theme="cafe"]{
  --bg:#f7f4ee; --fg:#1f2937; --muted:#6b7280;
  --card:#fff8f1; --b:#d6ccc2;
  --acc:#b45309; --acc2:#7c3e0a;
  --chip:#ffffff;
  --shadow:0 12px 28px rgba(120,64,16,.12);
  --panel:#fff4ea; --text:#1f2937;

  --modal-overlay: rgba(34, 24, 14, .62);
  --dialog-bg:#fff8f1;
  --dialog-border:#d6ccc2;
  --dialog-shadow: 0 22px 60px rgba(80,40,8,.28), 0 8px 24px rgba(80,40,8,.16);
}

/* ========================= GLOBAL ========================= */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--fg);
}
header{max-width:1200px;margin:auto;padding:22px 16px 0}
h1{margin:0 0 4px;font-size:clamp(24px,3.4vw,36px)}
p.lead{margin:0;color:var(--muted)}
.wrap{max-width:1200px;margin:18px auto 40px;padding:0 16px}

.panel{
  background:var(--card);
  border:1px solid var(--b);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

/* ========================= TOP BAR ========================= */
.topbar{
  display:flex;gap:10px;
  align-items:center;justify-content:space-between;
  padding:10px 12px;border-bottom:1px solid var(--b);
  flex-wrap:wrap
}
.group{display:flex;gap:6px;align-items:center;flex-wrap:wrap}

.badge{
  display:inline-flex;align-items:center;gap:6px;
  padding:4px 10px;border-radius:999px;
  border:1px solid var(--b);
  background:var(--chip);
  font-size:12px;color:var(--muted)
}

/* ========================= THEME BUTTONS ========================= */
.tbtn{
  padding:8px 10px;border:1px solid var(--b);
  border-radius:10px;background:var(--chip);
  cursor:pointer;font-size:13px;transition:.25s
}
.tbtn.active{
  outline:2px solid var(--acc);
  box-shadow:inset 0 0 0 999px rgba(14,165,233,.08)
}

.themes .tbtn{position:relative;padding-inline-start:28px}
.themes .tbtn::before{
  content:"";position:absolute;inset-inline-start:8px;top:50%;
  transform:translateY(-50%);width:12px;height:12px;border-radius:999px;border:1px solid var(--b)
}
.themes .tbtn[data-theme="light"]{background:#ffffff;color:#111827;border-color:#e5e7eb}
.themes .tbtn[data-theme="dark"]{background:#0b1220;color:#e5e7eb;border-color:#1f2937}
.themes .tbtn[data-theme="cafe"]{background:#fff5eb;color:#7c3e0a;border-color:#d6ccc2}

/* ========================= TABS ========================= */
.tabs{display:flex;gap:8px;padding:10px;border-bottom:1px solid var(--b)}
.tab{
  padding:10px 14px;border-radius:12px;cursor:pointer;
  border:1px solid var(--b);background:var(--chip)
}
.tab.active{
  background:linear-gradient(180deg,rgba(14,165,233,.12),transparent);
  outline:2px solid var(--acc)
}
.section{display:none}
.section.active{display:block}

/* ========================= GRID & CARDS ========================= */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:14px;padding:16px
}
.cat-head{
  position:sticky;top:0;
  background:linear-gradient(180deg,var(--bg),rgba(0,0,0,0));
  backdrop-filter:saturate(110%) blur(2px);
  margin:12px 0 4px;border-bottom:1px dashed var(--b);
  padding:8px 4px;z-index:1;display:flex;align-items:center;gap:10px
}
.cat-head h3{margin:0;font-size:18px}
.fold-btn{margin-inline-start:auto;font-size:12px}
.subcounts{display:block;font-size:12px;color:var(--muted);margin-inline-start:6px}

.card{
  background:var(--card);
  border:1px solid var(--b);
  border-radius:16px;padding:14px;
  display:flex;flex-direction:column;gap:10px;
  box-shadow:var(--shadow)
}
[data-theme="dark"] .card{
  background:linear-gradient(180deg,rgba(255,255,255,.03),transparent)
}

.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.muted{color:var(--muted);font-size:13px}
.score{margin-inline-start:auto;color:var(--acc2);font-weight:700}

.cat{background:rgba(14,165,233,.15);color:var(--acc2)}
.strength{background:rgba(34,197,94,.15);color:#16a34a}
.bean{background:rgba(234,179,8,.22);color:#a16207}

/* ========================= BUTTONS ========================= */
button{
  border:1px solid var(--b);
  background:linear-gradient(180deg,rgba(14,165,233,.15),rgba(14,165,233,.06));
  color:inherit;padding:10px 14px;border-radius:12px;cursor:pointer;transition:.25s
}
button:hover{border-color:var(--acc)}
.ghost{background:var(--chip)}

/* ========================= FILTERS ========================= */
.cta{
  padding:14px;display:flex;gap:10px;align-items:center;justify-content:space-between;
  border-top:1px solid var(--b);flex-wrap:wrap
}
.filters{display:flex;gap:8px;flex-wrap:wrap}
.empty{padding:16px;color:var(--muted)}

/* ========== Elegant Selects ========== */
select{
  padding:10px 32px 10px 12px;
  border:1px solid var(--b);
  border-radius:12px;
  background:var(--card);
  color:var(--fg);
  font-size:15px;cursor:pointer;transition:all .25s ease;
  box-shadow:0 3px 10px rgba(2,6,23,.06);
  appearance:none;
  background-image:
    linear-gradient(45deg, transparent 50%, var(--muted) 50%),
    linear-gradient(135deg, var(--muted) 50%, transparent 50%);
  background-position:
    calc(100% - 14px) calc(50% - 4px),
    calc(100% - 9px) calc(50% - 4px);
  background-size:6px 6px, 6px 6px;
  background-repeat:no-repeat
}
select:hover{
  border-color:var(--acc);
  box-shadow:0 4px 14px rgba(2,6,23,.12)
}
select:focus{
  outline:none;border-color:var(--acc);
  box-shadow:0 0 0 3px rgba(14,165,233,.25)
}
/* دعم الثيمين الداكن والمقهى */
[data-theme="dark"] select,
[data-theme="cafe"] select{
  background:var(--panel);
  color:var(--text);
  border-color:var(--b);
  box-shadow:0 3px 10px rgba(0,0,0,.3)
}
[data-theme="dark"] option,
[data-theme="cafe"] option{
  background:var(--panel);
  color:var(--text)
}

/* ========================= MODAL (تباين عالي) ========================= */
.modal{
  position:fixed;inset:0;
  background: var(--modal-overlay);             /* طبقة تعتيم أوضح */
  backdrop-filter: blur(5px) saturate(110%);
  -webkit-backdrop-filter: blur(5px) saturate(110%);
  display:none;align-items:center;justify-content:center;
  padding:20px;transition:opacity .25s ease;
  z-index: 1000; /* فوق كل العناصر */
}

.dialog{
  max-width:880px;width:100%;
  background: var(--dialog-bg);                 /* خلفية متباينة عن --card */
  border:1px solid var(--dialog-border);
  border-radius:16px;
  box-shadow: var(--dialog-shadow);
  transform:translateY(22px) scale(.99);
  opacity:0;
  transition:opacity .25s ease, transform .25s ease, box-shadow .25s ease;
}

/* عند الإظهار: JS يضيف .show للـ .modal */
.modal.show .dialog{
  transform:translateY(0) scale(1);
  opacity:1;
}

/* رأس ومحتوى أكثر وضوحًا */
.dialog header{
  padding:14px 16px;border-bottom:1px solid var(--dialog-border);
  background: rgba(255,255,255,.04);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}
[data-theme="dark"] .dialog header{
  background: rgba(255,255,255,.06);
}

.dialog .content{
  padding:12px 16px 16px;
  background: rgba(255,255,255,.02);
}
[data-theme="dark"] .dialog .content{
  background: rgba(255,255,255,.04);
}

/* تحسين تباين النص داخل المودال */
.dialog b{color:var(--fg)}
.kv{display:grid;grid-template-columns:160px 1fr;gap:6px 10px}

/* ========================= CHIPS ========================= */
.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
.chip{
  padding:6px 10px;border:1px solid var(--b);
  border-radius:999px;background:var(--chip);
  font-size:12px;cursor:pointer;user-select:none
}
.chip.active{
  outline:2px solid var(--acc);
  background:rgba(14,165,233,.12)
}
.chip[disabled]{opacity:.4;filter:grayscale(1)}

/* ========================= SAFETY FALLBACK ========================= */
/* لو المودال ظاهر بـ display:flex ولم تُضَف .show لأي سبب، اعرض الـ dialog */
.modal[style*="display: flex"] .dialog{
  opacity: 1 !important;
  transform: translateY(0) scale(1) !important;
}
