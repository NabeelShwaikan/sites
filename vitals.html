<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุญุงุณุจุฉ ุงููุคุดุฑุงุช ุงูุตุญูุฉ โ ุชูุณูุฑ ุขูู + "ุงุนุฑู ุฃูุซุฑ" (v7)</title>
  <style>
    :root{--bg1:#e0f2fe;--bg2:#ede9fe;--panel:#fff;--border:rgba(2,6,23,.10);--text:#0f172a;--muted:#475569;--accent:#818cf8;--accent2:#38bdf8;--radius:18px;--shadow:0 8px 24px rgba(2,6,23,.10)}
    body{margin:0;font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);padding:16px 16px 96px;line-height:1.55}

    /* ุจุทุงูุงุช */
    .kpi{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:12px 14px;margin-bottom:10px;box-shadow:var(--shadow);transition:background .35s,color .35s,border-color .35s}
    .kpi h3{margin:0 0 4px;font-size:15px;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .value{font-size:19px;font-weight:800;margin-top:4px}
    .detail{font-size:13px;color:var(--muted)}
    .badge{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:11px;color:var(--muted);margin-inline-start:6px}

    /* ุงุนุฑู ุฃูุซุฑ */
    .more-btn{background:transparent;border:none;cursor:pointer;font-size:12px;color:var(--muted);display:inline-flex;align-items:center;gap:6px;border-radius:8px;padding:2px 8px}
    .more-btn:hover{background:rgba(2,6,23,.06)}
    .chev{display:inline-block;transition:transform .2s ease}
    .more{display:none;margin-top:6px;padding-top:6px;border-top:1px dashed var(--border);font-size:12.5px;color:var(--muted)}
    .kpi.open .chev{transform:rotate(90deg)}
    .kpi.open .more{display:block}

    /* ุดุฑุงุฆุญ ุงูุญุงูุฉ */
    .status{margin-top:6px}
    .chip{display:inline-block;padding:2px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid var(--border)}
    .ok{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
    .warn{background:#fff7ed;color:#92400e;border-color:#fed7aa}
    .bad{background:#fef2f2;color:#991b1b;border-color:#fecaca}
    .info{background:#eff6ff;color:#1e40af;border-color:#bfdbfe}

    /* ุชุจููุจุงุช */
    .tabs{display:flex;gap:8px;align-items:center;margin:12px 0}
    .tab-btn{border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700;color:var(--text)}
    .tab-btn.active{background:var(--panel);box-shadow:var(--shadow)}

    /* ุดุฑูุท ุงูุณูุฉ */
    .themebar{display:flex;gap:10px;align-items:center;margin:8px 0 12px}
    .select-wrap{position:relative;display:inline-flex;align-items:center}
    #themeSelect{appearance:none;-moz-appearance:none;-webkit-appearance:none;padding:8px 36px 8px 12px;border-radius:999px;border:1px solid var(--border);background:var(--panel);color:var(--text);font-weight:700;box-shadow:0 6px 16px rgba(2,6,23,.06)}
    .chevsel{position:absolute;right:10px;pointer-events:none;color:var(--muted);font-weight:900}

    /* ุงูุณูุงุช ูุงููุฉ */
    html[data-theme="day"]{--bg1:#fff7ed;--bg2:#ffedd5;--panel:#ffffff;--border:rgba(2,6,23,.08);--text:#0f172a;--muted:#6b7280;--accent:#f59e0b;--accent2:#f97316}
    html[data-theme="morning"]{--bg1:#e0f2fe;--bg2:#ede9fe;--panel:#ffffff;--border:rgba(2,6,23,.08);--text:#0f172a;--muted:#334155;--accent:#818cf8;--accent2:#38bdf8}
    html[data-theme="dark"]{--bg1:#0b1220;--bg2:#111827;--panel:#0b1220;--border:rgba(255,255,255,.10);--text:#e2e8f0;--muted:#cbd5e1;--accent:#a78bfa;--accent2:#22d3ee}
    html[data-theme="nature"]{--bg1:#ecfccb;--bg2:#d9f99d;--panel:#ffffff;--border:rgba(2,6,23,.08);--text:#052e16;--muted:#166534;--accent:#22c55e;--accent2:#4ade80}
    html[data-theme="sunset"]{--bg1:#fce7f3;--bg2:#fde68a;--panel:#ffffff;--border:rgba(2,6,23,.08);--text:#3f1d2e;--muted:#7c2d12;--accent:#f472b6;--accent2:#fb923c}
    html[data-theme="ice"]{--bg1:#e0f2fe;--bg2:#f0f9ff;--panel:#ffffff;--border:rgba(2,6,23,.08);--text:#0c4a6e;--muted:#0369a1;--accent:#38bdf8;--accent2:#7dd3fc}
    html[data-theme="neon"]{--bg1:#080b12;--bg2:#0f172a;--panel:#0b1220;--border:rgba(255,255,255,.12);--text:#e5e7eb;--muted:#a5b4fc;--accent:#22d3ee;--accent2:#a78bfa}
    html[data-theme="cosmic"]{--bg1:#1f1d2b;--bg2:#111827;--panel:#141624;--border:rgba(255,255,255,.10);--text:#e2e8f0;--muted:#c7d2fe;--accent:#8b5cf6;--accent2:#06b6d4}
    html[data-theme="blossom"]{--bg1:#ffe4e6;--bg2:#ede9fe;--panel:#ffffff;--border:rgba(2,6,23,.08);--text:#4a044e;--muted:#7e22ce;--accent:#f9a8d4;--accent2:#c084fc}
    html[data-theme="dark"] .detail.note{background:rgba(17,24,39,.6)}

    /* ุจุทุงูุฉ ุงูุฅุฏุฎุงู */
    #inputsCard{padding:10px 12px}
    #inputsCard h3{font-size:14px}
    #inputsCard .detail{font-size:12.5px}
    #inputsCard .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
    #inputsCard label{font-size:12.5px;color:var(--muted);display:block}
    #inputsCard label>span{display:block;margin-bottom:4px}
    #inputsCard input,#inputsCard select{width:100%;height:36px;padding:6px 10px;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text);font-size:14px;box-sizing:border-box}
    #inputsCard input::placeholder{color:#94a3b8}
    #inputsCard .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    html[data-theme="dark"] #inputsCard input,html[data-theme="dark"] #inputsCard select{background:#0f172a;color:#e2e8f0;border-color:rgba(255,255,255,.16)}

    /* ุงูุชุตููุฑ ุฃุณูู ุงูุตูุญุฉ */
    .vizWrap{display:grid;grid-template-columns:1fr;gap:10px;margin:10px 0}
    .viz,.viz3d{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:10px;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow)}
    .viz svg{width:100%;height:auto;max-height:340px}
    .viz3d{display:none}
    #body3d{width:100%;height:360px;display:block}
    .toggle{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <!-- ุงุฎุชูุงุฑ ุงูููุท -->
  <div class="themebar">
    <span style="font-size:13px;color:var(--muted)">ุงุฎุชุฑ ุงูุณูุฉ ุงูููุงุณุจุฉ ูู:</span>
    <div class="select-wrap">
      <select id="themeSelect" aria-label="ุงุฎุชูุงุฑ ุงูููุท">
        <option value="dark">ุฏุงูู ุญููู</option>
        <option value="morning">ุตุจุงุญู ูุดุฑู</option>
              <option value="day">ููุงุฑู</option>
        <option value="sunset">ุบุฑูุจ</option>
        <option value="nature">ุทุจูุนู (ุฃุฎุถุฑ)</option>
        <option value="ice">ุซูุฌู</option>
        <option value="neon">ูููู ุฏุงูู</option>
        <option value="cosmic">ูุถุงุฆู</option>
        <option value="blossom">ุฒูุฑู</option>
      </select>
      <span class="chevsel">โพ</span>
    </div>
  </div>

  <!-- ุฅุฏุฎุงู ุงูุจูุงูุงุช -->
  <div class="kpi" id="inputsCard">
    <h3>๐ ุฃุฏุฎู ุจูุงูุงุชู ุงูุฃุณุงุณูุฉ</h3>
    <div class="detail" style="margin:6px 0 10px">ุงูุนูุฑุ ุงูุฌูุณุ ุงูุทููุ ุงููุฒูุ ูุญูุท ุงูุฎุตุฑ (ูููู ุงุฎุชูุงุฑูุฉ ุฃุฎุฑู). ุงููุชุงุฆุฌ ูุง ุชูุบูู ุนู ุงูุงุณุชุดุงุฑุฉ ุงูุทุจูุฉ.</div>
    <div class="row">
      <label><span>ุงูุนูุฑ (ุณูุฉ)</span><input id="age" type="number" min="5" max="120" placeholder="ูุซุงู: 35"></label>
      <label><span>ุงูุฌูุณ</span><select id="sex"><option value="male">ุฐูุฑ</option><option value="female">ุฃูุซู</option></select></label>
      <label><span>ุงูุทูู (ุณู)</span><input id="height" type="number" min="80" max="250" placeholder="ูุซุงู: 175"></label>
      <label><span>ุงููุฒู (ูุฌู)</span><input id="weight" type="number" min="20" max="400" placeholder="ูุซุงู: 80"></label>
      <label><span>ูุญูุท ุงูุฎุตุฑ (ุณู)</span><input id="waist" type="number" min="30" max="200" placeholder="ูุซุงู: 92"></label>
      <label><span>ุงููุดุงุท (TDEE)</span><select id="activity"><option value="1.2">ูููู ุงูุญุฑูุฉ</option><option value="1.375">ูุดุงุท ุฎููู (1โ3/ุฃุณุจูุน)</option><option value="1.55">ูุดุงุท ูุชูุณุท (3โ5/ุฃุณุจูุน)</option><option value="1.725">ุนุงูู (6โ7/ุฃุณุจูุน)</option><option value="1.9">ุนุงูู ุฌุฏูุง</option></select></label>
      <label><span>ูุญูุท ุงููุฑู (ุณู) โ ุงุฎุชูุงุฑู</span><input id="hip" type="number" min="40" max="220" placeholder="ุงุฎุชูุงุฑู"></label>
      <label><span>ูุญูุท ุงูุฑูุจุฉ (ุณู) โ ุงุฎุชูุงุฑู</span><input id="neck" type="number" min="20" max="70" placeholder="ุงุฎุชูุงุฑู"></label>
      <label><span>ุถุบุท ุงููุจุงุถู (ุฃุนูู) โ ุงุฎุชูุงุฑู</span><input id="sbp" type="number" min="70" max="240" placeholder="ุงุฎุชูุงุฑู"></label>
      <label><span>ุถุบุท ุงูุจุณุงุทู (ุฃุฏูู) โ ุงุฎุชูุงุฑู</span><input id="dbp" type="number" min="40" max="140" placeholder="ุงุฎุชูุงุฑู"></label>
    </div>
    <div class="actions">
      <button id="calc" class="tab-btn" style="background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0b1220">ุงุญุณุจ ุงูุขู</button>
      <button id="reset" class="tab-btn">ูุณุญ ุงููุฏุฎูุงุช</button>
    </div>
  </div>

  <!-- ุชุจููุจุงุช ุงููุชุงุฆุฌ -->
  <div class="tabs">
    <button class="tab-btn active" data-target="primarySection">ุงููุคุดุฑุงุช ุงูุฃุณุงุณูุฉ</button>
    <button class="tab-btn" data-target="secondarySection">ุงููุคุดุฑุงุช ุงูุซุงูููุฉ</button>
    <button class="tab-btn" data-target="vitalsSection">ุงููุคุดุฑุงุช ุงูุญูููุฉ</button>
  </div>

  <!-- ุงูุฃุณุงุณูุฉ -->
  <section id="primarySection">
    <h2>๐ ุงููุคุดุฑุงุช ุงูุตุญูุฉ ุงูุฃุณุงุณูุฉ</h2>

    <div class="kpi" data-metric="bmi">
      <h3>ูุคุดุฑ ูุชูุฉ ุงูุฌุณู (BMI)
        <button class="more-btn" data-id="bmi"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="bmiVal">โ</div>
      <div class="status"><span class="chip info" id="bmiChip">โ</span></div>
      <div class="more" data-id="bmi"><b>ูุง ููุ</b> ุงููุฒู (ูุฌู) รท ุงูุทููยฒ (ูยฒ). ุฃุฏุงุฉ ุนุงูุฉ ูุชูุฏูุฑ ุงูุณููุฉ.
        <ul>
          <li>18.5โ24.9: ุทุจูุนู</li>
          <li>25โ29.9: ุฒูุงุฏุฉ ูุฒู</li>
          <li>โฅ30: ุณููุฉ (ุฏุฑุฌุงุช)</li>
        </ul>
        <b>ูุญุฏูุฏูุงุช:</b> ูุง ููุฑูู ุจูู ุงูุนุถูุงุช ูุงูุฏูููุ ุฑุงูุจ WHtR ูุงูุฎุตุฑ ุฃูุถูุง.
      </div>
    </div>

    <div class="kpi" data-metric="whtr">
      <h3>ูุณุจุฉ ุงูุฎุตุฑ ููุทูู (WHtR)
        <button class="more-btn" data-id="whtr"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="whtrVal">โ</div>
      <div class="status"><span class="chip info" id="whtrChip">โ</span></div>
      <div class="more" data-id="whtr">ุงูุฎุตุฑ รท ุงูุทูู (ุจุงูุณู). ุญุณุงุณุฉ ูุฏููู ุงูุจุทู. ุบุงูุจูุง ุงูุฃูุถู < 0.50ุ โฅ0.60 ูุฑุชุจุท ุจูุฎุงุทุฑ ุฃุนูู.</div>
    </div>

    <div class="kpi" data-metric="waist">
      <h3>ูุญูุท ุงูุฎุตุฑ
        <button class="more-btn" data-id="waist"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="waistVal">โ</div>
      <div class="status"><span class="chip info" id="waistChip">โ</span></div>
      <div class="more" data-id="waist">ุฑุฌุงู: ุญุฏูู โฅ94 ุณู (ูุฑุชูุน โฅ102) โข ูุณุงุก: ุญุฏูู โฅ80 (ูุฑุชูุน โฅ88). ุงูููุงุณ ุนูุฏ ุงูุณุฑุฉ ุจุนุฏ ุฒููุฑ ุทุจูุนู.</div>
    </div>

    <div class="kpi" data-metric="bp">
      <h3>ุถุบุท ุงูุฏู
        <button class="more-btn" data-id="bp"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="bpVal">โ</div>
      <div class="status"><span class="chip info" id="bpChip">โ</span></div>
      <div class="more" data-id="bp">ุทุจูุนู ุนุงุฏุฉู ุฃูู ูู 120/80 ูู ุฒุฆุจู. ูุฑูุฑ ุงูููุงุณ ูู ุฃููุงุช ูุฎุชููุฉ ูุชุฌููุจ ุงูููุจููุงุช ูุจู 30 ุฏูููุฉ.</div>
    </div>

    <div class="kpi" data-metric="tdee">
      <h3>ุงูุณุนุฑุงุช ุงูููููุฉ (TDEE)
        <button class="more-btn" data-id="tdee"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="tdeeVal">โ</div>
      <div class="status"><span class="chip info" id="tdeeChip">โ</span></div>
      <div class="more" data-id="tdee">ููุดุชู ูู MifflinโSt Jeor ร ูุนุงูู ุงููุดุงุท. ููุชูุญูู: ูุงูุต 10โ20% ูู TDEE ุชุฏุฑูุฌููุง.</div>
    </div>

    <div class="kpi" data-metric="protein">
      <h3>ุงุญุชูุงุฌ ุงูุจุฑูุชูู ุงููููู
        <button class="more-btn" data-id="protein"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="proteinVal">โ</div>
      <div class="status"><span class="chip info" id="proteinChip">โ</span></div>
      <div class="more" data-id="protein">ูุทุงู ุนุงู 1.2โ1.6ุบ/ูุฌู (ูุฏ ูุตู 1.8ุบ ููุจุงุฑ ุงูุณูุ ูุญุชู 2.2ุบ ูุจุนุถ ุงูุฃูุฏุงู ุงูุฑูุงุถูุฉ).</div>
    </div>

    <div class="kpi" data-metric="sugar">
      <h3>ุงูุณูุฑ ุงูุญุฑู ุงููุณููุญ
        <button class="more-btn" data-id="sugar"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="sugarVal">โ</div>
      <div class="status"><span class="chip info" id="sugarChip">โ</span></div>
      <div class="more" data-id="sugar">ุงููุซุงูู โค5% ูู ุงูุณุนุฑุงุชุ ุงูุญุฏ ุงูุฃุนูู 10%. ูุถูู ุงููุงููุฉ ุงููุงููุฉ ุนูู ุงูุนุตุงุฆุฑ.</div>
    </div>

    <div class="kpi" data-metric="fiber">
      <h3>ุงูุฃููุงู ุงูููููุฉ
        <button class="more-btn" data-id="fiber"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="fiberVal">โ</div>
      <div class="status"><span class="chip info" id="fiberChip">โ</span></div>
      <div class="more" data-id="fiber">โ 14ุบ ููู 1000 ุณุนุฑุฉ. ุงุฑูุนูุง ุชุฏุฑูุฌููุง ูุน ุดุฑุจ ุงููุงุก ูุชุฌููุจ ุงูุงูุฒุนุงุฌ ุงููุถูู.</div>
    </div>

    <div class="kpi" data-metric="activity">
      <h3>ูุณุชูู ุงููุดุงุท ุงูุจุฏูู
        <button class="more-btn" data-id="activity"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="activityVal">โ</div>
      <div class="status"><span class="chip info" id="activityChip">โ</span></div>
      <div class="more" data-id="activity">ุงููุฏู 150โ300 ุฏูููุฉ/ุฃุณุจูุน ูุดุงุท ูุนุชุฏู + ุชูุงุฑูู ููุงููุฉ 2โ3 ุฃูุงู.</div>
    </div>
  </section>

  <!-- ุงูุซุงูููุฉ -->
  <section id="secondarySection" style="display:none">
    <h2>๐งฉ ุงููุคุดุฑุงุช ุงูุซุงูููุฉ (ููุณูุนุฉ)</h2>

    <div class="kpi" data-metric="ffmi">
      <h3>FFMI โ ูุคุดุฑ ุงููุชูุฉ ุงูุฎุงููุฉ ูู ุงูุฏููู
        <button class="more-btn" data-id="ffmi"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="ffmiVal">โ</div>
      <div class="status"><span class="chip info" id="ffmiChip">โ</span></div>
      <div class="more" data-id="ffmi">ูููุณ ุงููุชูุฉ ุงูุนุถููุฉ ูุณุจุฉู ููุทูู. ูููุฐุฌู: ุฑุฌุงู 18โ25ุ ูุณุงุก 15โ22. ููู ุฃุนูู ุฎุงุฑุฌ ุงููุทุงู ูุฏ ุชุนูุณ ูุชูุฉ ุนุถููุฉ ูุจูุฑุฉ ุฃู ุชูุฏูุฑูุง ุบูุฑ ุฏููู ููุฏููู.</div>
    </div>

    <div class="kpi" data-metric="absi">
      <h3>ABSI โ ูุคุดุฑ ุดูู ุงูุฌุณู
        <button class="more-btn" data-id="absi"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="absiVal">โ</div>
      <div class="status"><span class="chip info" id="absiChip">โ</span></div>
      <div class="more" data-id="absi">ูุณุชุฎุฏู ุงูุฎุตุฑ ูุงูุทูู ูBMIุ ูููุฉ ุฃุนูู ูุฏ ุชุดูุฑ ููุฎุงุทุฑ ุฃุนูู ูุณุชููุฉ ุนู BMI.
      </div>
    </div>

    <div class="kpi" data-metric="whr">
      <h3>WHR โ ูุณุจุฉ ุงูุฎุตุฑ ุฅูู ุงููุฑู
        <button class="more-btn" data-id="whr"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="whrVal">โ</div>
      <div class="status"><span class="chip info" id="whrChip">โ</span></div>
      <div class="more" data-id="whr">ุฑุฌุงู: โค0.90 ุฃูุถูุ ูุณุงุก: โค0.85. ุฃุนูู ูู ุฐูู ูุฏ ูุดูุฑ ุฅูู ุชูุฑูุฒ ุฏููู ูุฑูุฒู.</div>
    </div>

    <div class="kpi" data-metric="navy">
      <h3>ุฏููู ุงูุฌุณู (ุทุฑููุฉ ุงูุจุญุฑูุฉ)
        <button class="more-btn" data-id="navy"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="navyVal">โ</div>
      <div class="status"><span class="chip info" id="navyChip">โ</span></div>
      <div class="more" data-id="navy">ุชูุฏูุฑ ุชูุฑูุจู ุจุงูููุงุณุงุช ุงููุญูุทูุฉุ ุงูุฑุฌุงู 10โ20%ุ ุงููุณุงุก 20โ30% ููุทุงูุงุช ุนุงูุฉ ููุตุญุฉ.
      </div>
    </div>

    <div class="kpi" data-metric="bmi_prime">
      <h3>BMI Prime
        <button class="more-btn" data-id="bmi_prime"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="bmiPrimeVal">โ</div>
      <div class="status"><span class="chip info" id="bmiPrimeChip">โ</span></div>
      <div class="more" data-id="bmi_prime">BMI รท 25. 0.80โ1.00 ุฃูุถูุ >1 ูุนูู ููู ุงูุทุจูุนู.</div>
    </div>

    <div class="kpi" data-metric="pi">
      <h3>PI โ ูุคุดุฑ ุจููุฏูุฑุงู
        <button class="more-btn" data-id="pi"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="piVal">โ</div>
      <div class="status"><span class="chip info" id="piChip">โ</span></div>
      <div class="more" data-id="pi">ููููู ูู BMI ููุฃุฎุฐ ุทูู ุงููุงูุฉ ูู ุงูุงุนุชุจุงุฑ ุจุดูู ุฃูุจุฑ.</div>
    </div>

    <div class="kpi" data-metric="hwrange">
      <h3>ูุทุงู ูุฒู ุตุญู ูุทููู
        <button class="more-btn" data-id="hwrange"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="hwrangeVal">โ</div>
      <div class="status"><span class="chip info" id="hwrangeChip">โ</span></div>
      <div class="more" data-id="hwrange">ูุทุงู ุงุณุชุฑุดุงุฏู ูุณุงุนุฏ ุนูู ุชุญุฏูุฏ ูุฏู ูุงูุนู ุจุฏู ุฑูู ูุงุญุฏ ุซุงุจุช.</div>
    </div>

    <div class="kpi" data-metric="bsa">
      <h3>BSA โ ูุณุงุญุฉ ุณุทุญ ุงูุฌุณู
        <button class="more-btn" data-id="bsa"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="bsaVal">โ</div>
      <div class="status"><span class="chip info" id="bsaChip">โ</span></div>
      <div class="more" data-id="bsa">ูููุฏุฉ ูุจุนุถ ุงูุฌุฑุนุงุช ูุชูุฏูุฑุงุช ุณุฑูุฑูุฉ. ูุนุงุฏูุฉ Mosteller.</div>
    </div>

    <div class="kpi" data-metric="waist_target">
      <h3>ุฎุตุฑ ูุณุชูุฏู ูู ุงูุทูู
        <button class="more-btn" data-id="waist_target"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="waistTargetVal">โ</div>
      <div class="status"><span class="chip info" id="waistTargetChip">โ</span></div>
      <div class="more" data-id="waist_target">0.42โ0.50 ร ุงูุทูู ุบุงูุจูุง ูุฑุชุจุท ุจูุคุดุฑุงุช ุฃูุถูุฉ ุฃูุถู.
      </div>
    </div>
  </section>

  <!-- ุงูุญูููุฉ -->
  <section id="vitalsSection" style="display:none">
    <h2>๐ฉบ ุงููุคุดุฑุงุช ุงูุญูููุฉ ูุงููุชูุฏูุฉ</h2>
    <div class="detail note">ุจุนุถ ุงููุคุดุฑุงุช ุชุญุชุงุฌ <b>ุฅุฏุฎุงููุง ูุฏูููุง</b> (ุณุงุนุฉ/ุฌูุงุฒ ููุฒูู). ุฅู ูู ุชูุฏุฎู ูููุฉุ ุณุชุธูุฑ ุงููุนูููุงุช ููุฑุฌุน ููุท.</div>

    <div class="kpi" data-metric="rhr">
      <h3>ูุนุฏู ูุจุถ ุงูุฑุงุญุฉ (RHR) <span class="badge">ูุฏูู</span>
        <button class="more-btn" data-id="rhr"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="rhrVal">โ ูุจุถุฉ/ุฏูููุฉ</div>
      <div class="status"><span class="chip info" id="rhrChip">โ</span></div>
      <div class="detail"><label>ุฃุฏุฎู ุงููููุฉ: <input id="rhrInput" type="number" min="30" max="120" placeholder="ูุซุงู: 60" style="margin-inline-start:6px;padding:4px 8px;border-radius:8px;border:1px solid var(--border)"></label></div>
      <div class="more" data-id="rhr">ุนุงู: 60โ100ุ ุงูุฑูุงุถููู 40โ60. ุงุฑูุน ุงูููุงูุฉ ูููู RHR ุบุงูุจูุง.</div>
    </div>

    <div class="kpi" data-metric="spo2">
      <h3>ุชุดุจุน ุงูุฃูุณุฌูู (SpOโ) <span class="badge">ูุฏูู</span>
        <button class="more-btn" data-id="spo2"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="spo2Val">โ %</div>
      <div class="status"><span class="chip info" id="spo2Chip">โ</span></div>
      <div class="detail"><label>ุฃุฏุฎู ุงููููุฉ: <input id="spo2Input" type="number" min="70" max="100" placeholder="ูุซุงู: 97" style="margin-inline-start:6px;padding:4px 8px;border-radius:8px;border:1px solid var(--border)"> %</label></div>
      <div class="more" data-id="spo2">ุทุจูุนู 95โ100% ุนูู ูุณุชูู ุณุทุญ ุงูุจุญุฑ. ุฅู ูุงู ููุฎูุถูุง ุจุงุณุชูุฑุงุฑุ ุงุณุชุดุฑ ุงูุทุจูุจ.</div>
    </div>

    <div class="kpi" data-metric="resp">
      <h3>ูุนุฏู ุงูุชููุณ <span class="badge">ูุฏูู</span>
        <button class="more-btn" data-id="resp"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="respVal">โ ููุณ/ุฏูููุฉ</div>
      <div class="status"><span class="chip info" id="respChip">โ</span></div>
      <div class="detail"><label>ุฃุฏุฎู ุงููููุฉ: <input id="respInput" type="number" min="6" max="40" placeholder="ูุซุงู: 14" style="margin-inline-start:6px;padding:4px 8px;border-radius:8px;border:1px solid var(--border)"></label></div>
      <div class="more" data-id="resp">ุจุงูุบูู ูู ุงูุฑุงุญุฉ: 12โ20/ุฏูููุฉ. ุฃูู ุจูุซูุฑ ุฃู ุฃุนูู ุจุงุณุชูุฑุงุฑ ูุณุชูุฒู ุงุณุชุดุงุฑุฉ.</div>
    </div>

    <div class="kpi" data-metric="temp">
      <h3>ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ <span class="badge">ูุฏูู</span>
        <button class="more-btn" data-id="temp"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="tempVal">โ ยฐC</div>
      <div class="status"><span class="chip info" id="tempChip">โ</span></div>
      <div class="detail"><label>ุฃุฏุฎู ุงููููุฉ: <input id="tempInput" type="number" step="0.1" min="34" max="42" placeholder="ูุซุงู: 36.8" style="margin-inline-start:6px;padding:4px 8px;border-radius:8px;border:1px solid var(--border)"> ยฐC</label></div>
      <div class="more" data-id="temp">ูุทุงู ุดุงุฆุน: 36.1โ37.2ยฐC. ุงูุญูููู ุนุงุฏุฉ โฅ38ยฐC.</div>
    </div>

    <div class="kpi" data-metric="vo2">
      <h3>VOโmax (ุชูุฏูุฑู) <span class="badge">ุชูุฏูุฑู</span>
        <button class="more-btn" data-id="vo2"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="vo2Val">โ ูู/ูุฌู/ุฏูููุฉ</div>
      <div class="status"><span class="chip info" id="vo2Chip">โ</span></div>
      <div class="more" data-id="vo2">ูุนูุณ ุงูููุงูุฉ ุงูููุจูุฉ ุงูุชููุณูุฉ. ูููู ุชูุฏูุฑู ูุงุญููุง ุจุตูุบ ูุจุณุทุฉ ุงุนุชูุงุฏูุง ุนูู ุงูุนูุฑ/ุงูุฌูุณ/ุงููุดุงุท.</div>
    </div>

    <div class="kpi" data-metric="sleep">
      <h3>ุงูููู (ุงูุณุงุนุงุช/ุงูุฌูุฏุฉ) <span class="badge">ูุฏูู</span>
        <button class="more-btn" data-id="sleep"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="sleepVal">โ ุณุงุนุงุช</div>
      <div class="status"><span class="chip info" id="sleepChip">โ</span></div>
      <div class="detail"><label>ุฃุฏุฎู ุงูุณุงุนุงุช: <input id="sleepInput" type="number" step="0.1" min="0" max="16" placeholder="ูุซุงู: 7.5" style="margin-inline-start:6px;padding:4px 8px;border-radius:8px;border:1px solid var(--border)"></label></div>
      <div class="more" data-id="sleep">ุงูุชูุตูุฉ ุงูุนุงูุฉ: 7โ9 ุณุงุนุงุช ููุจุงูุบูู. ุฌูุฏุฉ ุงูููู ูุง ุชูู ุฃูููุฉ ุนู ุงููููุฉ.</div>
    </div>

    <div class="kpi" data-metric="hrv">
      <h3>ุชููุจ ูุจุถ ุงูููุจ (HRV) <span class="badge">ูุฏูู</span>
        <button class="more-btn" data-id="hrv"><span class="chev">โถ</span> ุงุนุฑู ุฃูุซุฑ</button>
      </h3>
      <div class="value" id="hrvVal">โ ms</div>
      <div class="status"><span class="chip info" id="hrvChip">โ</span></div>
      <div class="detail"><label>ุฃุฏุฎู ุงููููุฉ: <input id="hrvInput" type="number" min="5" max="200" placeholder="ูุซุงู: 55" style="margin-inline-start:6px;padding:4px 8px;border-radius:8px;border:1px solid var(--border)"> ms</label></div>
      <div class="more" data-id="hrv">ููู ุฃุนูู ุบุงูุจูุง ุนูุงูุฉ ุชุนุงูู ุฃูุถูุ ุงูููู ููุฎูุถุฉ ุฌุฏูุง ูุน ุฃุนุฑุงุถ ูุฏ ุชุณุชูุฒู ูุญุตูุง.</div>
    </div>
  </section>

  <!-- ุงูุชุตููุฑ ูู ุงูุฃุณูู -->
  <div class="kpi" id="vizCard">
    <h3>๐งโโ๏ธ ุชุตููุฑ ุงูุฌุณู โ 2D / 3D</h3>
    <div class="vizWrap">
      <div class="viz"><svg id="bodyViz" viewBox="0 0 200 420" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="200" height="420" fill="none"/></svg></div>
      <label class="toggle"><input type="checkbox" id="enable3d"> ุชูุนูู ูููุฐุฌ ุซูุงุซู ุงูุฃุจุนุงุฏ (ุชุฌุฑูุจู)</label>
      <div class="viz3d" id="viz3d"><canvas id="body3d" width="640" height="360"></canvas></div>
    </div>
    <div class="detail">ููุญุฏูุซ ุงูุชุตููุฑ ุจุนุฏ ุงูุถุบุท ุนูู ยซุงุญุณุจ ุงูุขูยป. ุงูุชูููู ููููุญ ููุฎุงุทุฑ ุชูุฑูุฒ ุงูุฏููู ุญูู ุงูุฎุตุฑ.</div>
  </div>

  <script>
    // ===== ุงูุณูุงุช =====
    const THEME_KEY='health:theme:v1';
    function setTheme(t){document.documentElement.setAttribute('data-theme',t);try{localStorage.setItem(THEME_KEY,t);}catch(e){} const sel=document.getElementById('themeSelect'); if(sel&&sel.value!==t) sel.value=t;}
    (function(){const saved=localStorage.getItem(THEME_KEY)||'morning'; setTheme(saved); const sel=document.getElementById('themeSelect'); if(sel){ sel.value=saved; sel.addEventListener('change',()=> setTheme(sel.value)); }})();

    // ===== ุชุจููุจุงุช =====
    document.querySelectorAll('.tab-btn').forEach(btn=>{btn.addEventListener('click',()=>{document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const target=btn.getAttribute('data-target'); document.querySelectorAll('section').forEach(sec=> sec.style.display=(sec.id===target)?'block':'none'); window.scrollTo({top:0,behavior:'smooth'});});});

    // ===== ุงุนุฑู ุฃูุซุฑ (Toggle) =====
    document.body.addEventListener('click',e=>{const b=e.target.closest('.more-btn'); if(!b) return; e.preventDefault(); const host=b.closest('.kpi'); const sec=b.closest('section'); sec?.querySelectorAll('.kpi').forEach(k=>{if(k!==host) k.classList.remove('open');}); host.classList.toggle('open');});

    // ===== ุฃุฏูุงุช ูุณุงุนุฏุฉ =====
    const $=s=>document.querySelector(s);
    const toM=cm=>Number(cm)/100; const toIn=cm=>Number(cm)/2.54;
    const BMI=(kg,cm)=> kg/Math.pow(toM(cm),2);
    const WHtR=(wc,cm)=> wc/cm;
    const BMR=(kg,cm,a,s)=> s==='male'?(10*kg+6.25*cm-5*a+5):(10*kg+6.25*cm-5*a-161);
    const TDEE=(bmr,act)=> bmr*act;
    const LBM=(kg,cm,s)=> s==='male'?(0.407*kg+0.267*cm-19.2):(0.252*kg+0.473*cm-48.3);
    const FFMI=(lbmKg,cm)=> lbmKg/Math.pow(toM(cm),2);
    const ABSI=(wc,bmi,cm)=>{const w=wc/100,h=cm/100;return w/(Math.pow(bmi,2/3)*Math.pow(h,1/2));};
    const WHR=(wc,hip)=> wc/hip;
    const NavyBF=(s,wc,neck,hip,height)=>{const w=toIn(wc), n=toIn(neck), h=toIn(height), hp=hip?toIn(hip):0; const maleTerm=Math.max(0.1,w-n); const femaleTerm=Math.max(0.1,w+hp-n); if(s==='male') return 86.010*Math.log10(maleTerm)-70.041*Math.log10(h)+36.76; return 163.205*Math.log10(femaleTerm)-97.684*Math.log10(h)-78.387;};
    const healthyWeightRange=cm=>{const m2=Math.pow(toM(cm),2);return{min:22*m2,max:25*m2}};
    const BSA=(kg,cm)=> Math.sqrt((kg*cm)/3600);

    // ===== ุฅูุดุงุก/ุฅุฑุฌุงุน ุนูุตุฑ ุงูุดุฑูุญุฉ ูุญุงูุฉ ูุคุดุฑ =====
    function chip(id){const el=document.getElementById(id); return el;}
    function setChip(id, cls, text){const c=chip(id); if(!c) return; c.classList.remove('ok','warn','bad','info'); c.classList.add(cls||'info'); c.textContent=text;}

    // ===== ุชูุงุณูุฑ ุงููุคุดุฑุงุช =====
    function interpretBMI(b){ if(!Number.isFinite(b)) return ['info','โ']; if(b<18.5) return ['warn','ูุญุงูุฉ']; if(b<25) return ['ok','ุทุจูุนู']; if(b<30) return ['warn','ุฒูุงุฏุฉ ูุฒู']; if(b<35) return ['bad','ุณููุฉ (1)']; if(b<40) return ['bad','ุณููุฉ (2)']; return ['bad','ุณููุฉ (3)']; }
    function interpretWHtR(x){ if(!Number.isFinite(x)) return ['info','โ']; if(x<0.45) return ['ok','ููุชุงุฒ']; if(x<0.50) return ['ok','ุตุญู']; if(x<0.55) return ['warn','ุญุฏูู']; if(x<0.60) return ['warn','ูุฑุชูุน']; return ['bad','ูุฑุชูุน ุฌุฏูุง']; }
    function interpretWaist(sex,wc){ if(!Number.isFinite(wc)) return ['info','โ']; if(sex==='male'){ if(wc>=102) return ['bad','ูุฑุชูุน']; if(wc>=94) return ['warn','ุญุฏูู']; return ['ok','ุทุจูุนู']; } else { if(wc>=88) return ['bad','ูุฑุชูุน']; if(wc>=80) return ['warn','ุญุฏูู']; return ['ok','ุทุจูุนู']; } }
    function interpretBP(sys,dia){ if(!(Number.isFinite(sys)&&Number.isFinite(dia))) return ['info','โ']; if(sys>=180||dia>=120) return ['bad','ุฃุฒูุฉ ุงุฑุชูุงุน ุถุบุท']; if(sys>=140||dia>=90) return ['bad','ุงุฑุชูุงุน ุถุบุท (ุฏุฑุฌุฉ 2)']; if(sys>=130||dia>=80) return ['warn','ุงุฑุชูุงุน ุถุบุท (ุฏุฑุฌุฉ 1)']; if(sys>=120&&dia<80) return ['warn','ุถุบุท ูุฑุชูุน (ูุณุจู)']; return ['ok','ุทุจูุนู']; }
    function interpretFFMI(sex,v){ if(!Number.isFinite(v)) return ['info','โ']; const r= sex==='male'?[18,25]:[15,22]; if(v<r[0]) return ['warn','ููุฎูุถ']; if(v>r[1]) return ['warn','ุนุงูู']; return ['ok','ุถูู ุงููุทุงู']; }
    function interpretWHR(sex,v){ if(!Number.isFinite(v)) return ['info','โ']; if(sex==='male'){ if(v<=0.90) return ['ok','ุฌููุฏ']; if(v<=1.00) return ['warn','ุญุฏูู']; return ['bad','ูุฑุชูุน']; } else { if(v<=0.85) return ['ok','ุฌููุฏ']; if(v<=0.95) return ['warn','ุญุฏูู']; return ['bad','ูุฑุชูุน']; } }
    function interpretNavy(sex,v){ if(!Number.isFinite(v)) return ['info','โ']; if(sex==='male'){ if(v<=20) return ['ok','ุฌููุฏ']; if(v<=25) return ['warn','ูุชูุณุท']; return ['bad','ูุฑุชูุน']; } else { if(v<=30) return ['ok','ุฌููุฏ']; if(v<=35) return ['warn','ูุชูุณุท']; return ['bad','ูุฑุชูุน']; } }
    function interpretBMIPrime(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v<0.8) return ['warn','ุฃูู ูู ุงูุทุจูุนู']; if(v<=1.0) return ['ok','ุทุจูุนู']; if(v<=1.2) return ['warn','ููู ุงูุทุจูุนู']; return ['bad','ูุฑุชูุน']; }
    function interpretPI(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v<11||v>14) return ['warn','ุฎุงุฑุฌ ุงููุทุงู']; return ['ok','ุถูู ุงููุทุงู']; }
    function interpretWaistTarget(wc,h){ if(!(Number.isFinite(wc)&&Number.isFinite(h))) return ['info','โ']; const min=0.42*h, max=0.50*h; if(wc<min) return ['warn','ุฃูู ูู ุงููุฏู']; if(wc<=max) return ['ok','ุถูู ุงููุฏู']; if(wc<=max+5) return ['warn','ูุฑูุจ ูู ุงููุฏู']; return ['bad','ุฃุนูู ูู ุงููุฏู']; }
    // ุญูููุฉ
    function interpretRHR(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v<40) return ['warn','ููุฎูุถ ุฌุฏูุง']; if(v<60) return ['ok','ุฌููุฏ']; if(v<=100) return ['ok','ุทุจูุนู']; return ['warn','ูุฑุชูุน']; }
    function interpretSpO2(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v>=95) return ['ok','ุทุจูุนู']; if(v>=92) return ['warn','ุญุฏูู']; return ['bad','ููุฎูุถ']; }
    function interpretResp(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v<10) return ['warn','ููุฎูุถ']; if(v<=20) return ['ok','ุทุจูุนู']; return ['warn','ูุฑุชูุน']; }
    function interpretTemp(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v<36.1) return ['warn','ููุฎูุถ']; if(v<=37.2) return ['ok','ุทุจูุนู']; if(v<38) return ['warn','ูุฑุชูุน ุจุณูุท']; return ['bad','ุญููู']; }
    function interpretSleep(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v<6) return ['warn','ูุตูุฑ']; if(v<=9) return ['ok','ุถูู ุงูุชูุตูุฉ']; return ['warn','ุทููู']; }
    function interpretHRV(v){ if(!Number.isFinite(v)) return ['info','โ']; if(v<20) return ['warn','ููุฎูุถ']; if(v<50) return ['info','ูุชูุณุท']; return ['ok','ุฌููุฏ']; }

    // ===== ุงูุญุณุงุจ ูุงูุนุฑุถ =====
    function computeAndRender(){
      const age=+$('#age').value; const sex=$('#sex').value||'male'; const h=+$('#height').value; const w=+$('#weight').value; const wc=+$('#waist').value; const hip=+$('#hip').value; const nk=+$('#neck').value; const SYS=+$('#sbp').value; const DIA=+$('#dbp').value; const act=+$('#activity').value||1.2;
      if(!(Number.isFinite(age)&&Number.isFinite(h)&&Number.isFinite(w)&&Number.isFinite(wc))){ alert('ูู ูุถูู ุฃููู: ุงูุนูุฑุ ุงูุฌูุณุ ุงูุทููุ ุงููุฒูุ ูุญูุท ุงูุฎุตุฑ'); return; }
      const bmi= BMI(w,h); const whtr= WHtR(wc,h); const bmr= BMR(w,h,age,sex); const tdee= TDEE(bmr,act); const lbm= LBM(w,h,sex); const ffmi= FFMI(lbm,h); const absi= ABSI(wc,bmi,h); const whr= Number.isFinite(hip)? WHR(wc,hip): NaN; const navy= (sex==='male'? (Number.isFinite(nk)&&wc>nk) : (Number.isFinite(nk)&&Number.isFinite(hip))) ? NavyBF(sex,wc,nk,hip,h): NaN; const bmiPrime=bmi/25; const pi= w/Math.pow(toM(h),3); const hwRange= healthyWeightRange(h); const bsa= BSA(w,h); const waistTargetMin=0.42*h, waistTargetMax=0.50*h;

      // ููู ุฑูููุฉ
      $('#bmiVal').textContent=bmi.toFixed(2);
      $('#whtrVal').textContent=whtr.toFixed(2);
      $('#waistVal').textContent=Math.round(wc)+' ุณู';
      $('#bpVal').textContent= (Number.isFinite(SYS)&&Number.isFinite(DIA))? `${Math.round(SYS)} / ${Math.round(DIA)} mmHg`:'โ';
      $('#tdeeVal').textContent= `โ ${Math.round(tdee)} ุณุนุฑุฉ/ููู`;
      const protLo=Math.round((age>=65?1.2:1.2)*w), protHi=Math.round((age>=65?1.8:1.6)*w); $('#proteinVal').textContent=`${protLo}โ${protHi} ุบ/ููู`;
      const sugarMax=Math.round((0.10*tdee)/4), sugarIdeal=Math.round((0.05*tdee)/4); $('#sugarVal').textContent=`โค ${sugarMax} ุบ/ููู (ูุซุงูู โค ${sugarIdeal})`;
      $('#fiberVal').textContent=`${Math.round(14*(tdee/1000))} ุบ/ููู`;
      $('#activityVal').textContent= act>=1.9?'ุนุงูู ุฌุฏูุง':act>=1.725?'ุนุงูู':act>=1.55?'ูุชูุณุท':act>=1.375?'ุฎููู':'ูููู/ุฎุงูู';

      // ุญุงูุงุช (ุดุฑุงุฆุญ)
      setChip('bmiChip', ...interpretBMI(bmi));
      setChip('whtrChip', ...interpretWHtR(whtr));
      setChip('waistChip', ...interpretWaist(sex,wc));
      setChip('bpChip', ...interpretBP(SYS,DIA));
      setChip('tdeeChip','info','ุงุณุชุฎุฏูู ููุฑุฌุน ููุณุนุฑุงุช');
      setChip('proteinChip','info','ูุทุงู ููุชุฑุญ ููู ุงููุฒู');
      setChip('sugarChip','info','ููุถูู ุงูุงูุชุฑุงุจ ูู 5%');
      setChip('fiberChip','info','ุงุฑูุนูุง ุชุฏุฑูุฌููุง');
      setChip('activityChip','info','ุฅุฑุดุงุฏู ููู ูุนุงูู ุงููุดุงุท');

      // ุซุงูููุฉ
      $('#ffmiVal').textContent= Number.isFinite(ffmi)? ffmi.toFixed(2):'โ'; setChip('ffmiChip', ...interpretFFMI(sex,ffmi));
      $('#absiVal').textContent= absi.toFixed(4); setChip('absiChip','info','ููููุงุฑูุฉ ุงููุณุจูุฉ');
      $('#whrVal').textContent= Number.isFinite(whr)? whr.toFixed(2):'โ'; setChip('whrChip', ...interpretWHR(sex,whr));
      $('#navyVal').textContent= Number.isFinite(navy)? navy.toFixed(1)+'%':'โ'; setChip('navyChip', ...interpretNavy(sex,navy));
      $('#bmiPrimeVal').textContent=bmiPrime.toFixed(2); setChip('bmiPrimeChip', ...interpretBMIPrime(bmiPrime));
      $('#piVal').textContent=pi.toFixed(2)+' ูุฌู/ูยณ'; setChip('piChip', ...interpretPI(pi));
      $('#hwrangeVal').textContent=`${hwRange.min.toFixed(1)}โ${hwRange.max.toFixed(1)} ูุฌู`; setChip('hwrangeChip','info','ูุทุงู ุงุณุชุฑุดุงุฏู');
      $('#bsaVal').textContent=bsa.toFixed(2)+' ูยฒ'; setChip('bsaChip','info','ููุงุณุชุฎุฏุงู ุงูุณุฑูุฑู');
      $('#waistTargetVal').textContent=`${Math.round(waistTargetMin)}โ${Math.round(waistTargetMax)} ุณู`; setChip('waistTargetChip', ...interpretWaistTarget(wc,h));

      // ุฑุณู
      draw2D({sex,bmi,whtr,waist:wc}); if($('#enable3d')?.checked){ start3D(sex,bmi,whtr); }
    }

    document.getElementById('calc').addEventListener('click', computeAndRender);
    document.getElementById('reset').addEventListener('click',()=>{['age','height','weight','waist','hip','neck','sbp','dbp'].forEach(id=>{const el=$('#'+id); if(el) el.value='';});
      ['bmiVal','whtrVal','waistVal','bpVal','tdeeVal','proteinVal','sugarVal','fiberVal','activityVal','ffmiVal','absiVal','whrVal','navyVal','bmiPrimeVal','piVal','hwrangeVal','bsaVal','waistTargetVal'].forEach(id=>{const el=$('#'+id); if(el) el.textContent='โ';});
      ['bmiChip','whtrChip','waistChip','bpChip','tdeeChip','proteinChip','sugarChip','fiberChip','activityChip','ffmiChip','absiChip','whrChip','navyChip','bmiPrimeChip','piChip','hwrangeChip','bsaChip','waistTargetChip','rhrChip','spo2Chip','respChip','tempChip','vo2Chip','sleepChip','hrvChip'].forEach(id=> setChip(id,'info','โ'));
      draw2D(null); stop3D(); });

    // ===== ุฑุจุท ุงูุญูููุฉ ูุชูุณูุฑูุง ูุจุงุดุฑุฉ =====
    function bindVital(id, interpret, suffix=''){
      const input=$(`#${id}Input`), out=$(`#${id}Val`), chipId=`${id}Chip`;
      if(!input||!out) return;
      const upd=()=>{const v=Number(input.value); out.textContent= Number.isFinite(v)? `${v}${suffix?(' '+suffix):''}` : `โ${suffix?(' '+suffix):''}`; const [c,t]=interpret(Number.isFinite(v)?v:NaN); setChip(chipId,c,t); };
      input.addEventListener('input',upd); upd();
    }
    bindVital('rhr', interpretRHR,'ูุจุถุฉ/ุฏูููุฉ');
    bindVital('spo2', interpretSpO2,'%');
    bindVital('resp', interpretResp,'ููุณ/ุฏูููุฉ');
    bindVital('temp', interpretTemp,'ยฐC');
    bindVital('sleep', interpretSleep,'ุณุงุนุงุช');
    bindVital('hrv', interpretHRV,'ms');

    // ===== ุฑุณู 2D =====
    function draw2D(state){const svg=document.getElementById('bodyViz'); if(!svg) return; if(!state){svg.innerHTML='<rect x="0" y="0" width="200" height="420" fill="none"/>'; return;} const {sex,bmi,whtr}=state; const base={shoulderW:120,chestW:110,waistW:70,hipW:105,torsoH:190,legH:170,headR:28}; const sexAdj=(sex==='male')?{shoulder:1.06,hip:0.95}:{shoulder:0.92,hip:1.06}; const bmiNorm=Math.max(16,Math.min(40,bmi)); const bmiScale=1+(bmiNorm-22)/40; const waistScale=Math.max(0.8,Math.min(1.6,whtr/0.5)); const shoulderW=base.shoulderW*sexAdj.shoulder*(0.9+(bmiScale-1)*0.5); const chestW=base.chestW*(0.9+(bmiScale-1)*0.6); const waistW=base.waistW*waistScale; const hipW=base.hipW*sexAdj.hip*(0.9+(bmiScale-1)*0.5); const riskColor=(whtr>=0.6)?'#dc2626':(whtr>=0.5?'#d97706':'#16a34a'); const cx=100; let y=10; svg.innerHTML=`<defs><linearGradient id="gradTorso" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#e2e8f0"/><stop offset="100%" stop-color="#cbd5e1"/></linearGradient><filter id="glow" x="-50%" y="-50%" width="200%" height="200%"><feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="#000" flood-opacity="0.08"/></filter></defs><circle cx="${cx}" cy="${y+base.headR}" r="${base.headR}" fill="#e2e8f0" stroke="#cbd5e1"/>`; y+=base.headR*2+6; svg.innerHTML+=`<path d="M ${cx-shoulderW/2} ${y} C ${cx-shoulderW/2} ${y-10}, ${cx+shoulderW/2} ${y-10}, ${cx+shoulderW/2} ${y} L ${cx+chestW/2} ${y+base.torsoH*0.35} C ${cx+chestW*0.2} ${y+base.torsoH*0.45}, ${cx-chestW*0.2} ${y+base.torsoH*0.45}, ${cx-chestW/2} ${y+base.torsoH*0.35} Z" fill="url(#gradTorso)" stroke="#cbd5e1" filter="url(#glow)"/>`; const wy=y+base.torsoH*0.35, wy2=wy+base.torsoH*0.25, hy=y+base.torsoH*0.65, hy2=hy+base.torsoH*0.22; svg.innerHTML+=`<path d="M ${cx-chestW/2} ${wy} C ${cx-waistW/2} ${wy2}, ${cx+waistW/2} ${wy2}, ${cx+chestW/2} ${wy} Z" fill="url(#gradTorso)" stroke="#cbd5e1"/><path d="M ${cx-waistW/2} ${hy} C ${cx-hipW/2} ${hy2}, ${cx+hipW/2} ${hy2}, ${cx+waistW/2} ${hy} Z" fill="url(#gradTorso)" stroke="#cbd5e1"/>`; const yLeg=10+base.headR*2+6+base.torsoH+10; svg.innerHTML+=`<path d="M ${cx-hipW*0.25} ${yLeg} L ${cx-hipW*0.15} ${yLeg+base.legH}" stroke="#cbd5e1" stroke-width="8"/><path d="M ${cx+hipW*0.25} ${yLeg} L ${cx+hipW*0.15} ${yLeg+base.legH}" stroke="#cbd5e1" stroke-width="8"/><ellipse cx="${cx}" cy="${10+base.headR*2+6+base.torsoH*0.55}" rx="${Math.max(waistW/2,20)}" ry="14" fill="none" stroke="${riskColor}" stroke-width="3" opacity="0.9"/>`; }

    // ===== 3D (ุชุฌุฑูุจู) =====
    const enable3d=document.getElementById('enable3d'); const canvas3d=document.getElementById('body3d'); const ctx3d=canvas3d?canvas3d.getContext('2d'):null; const viz3d=document.getElementById('viz3d'); let rafId=null,yaw=0,profile=null;
    function makeProfile(sex,bmi,whtr){const pts=[]; const baseShoulder=(sex==='male'?0.58:0.50)*(1+(bmi-22)/60); const baseChest=(sex==='male'?0.55:0.52)*(1+(bmi-22)/50); const baseWaist=0.36*Math.max(0.8,Math.min(1.6,whtr/0.5)); const baseHip=(sex==='male'?0.50:0.58)*(1+(bmi-22)/60); for(let i=0;i<=40;i++){const t=i/40; const chestBlend=Math.max(0,1-Math.abs(t-0.2)/0.25); const waistBlend=Math.max(0,1-Math.abs(t-0.5)/0.18); const hipBlend=Math.max(0,1-Math.abs(t-0.8)/0.22); let r=0; r+=baseChest*chestBlend; r+=baseWaist*waistBlend; r+=baseHip*hipBlend; r=Math.max(r, baseShoulder*Math.max(0,1-Math.abs(t-0.05)/0.18)); pts.push({y:t,r}); } return pts; }
    function start3D(sex,bmi,whtr){ if(!ctx3d) return; profile=makeProfile(sex,bmi,whtr); if(rafId) cancelAnimationFrame(rafId); yaw=0; viz3d.style.display='flex'; loop3D(); }
    function stop3D(){ if(rafId) cancelAnimationFrame(rafId); rafId=null; if(viz3d) viz3d.style.display='none'; }
    function loop3D(){ if(!ctx3d||!canvas3d) return; const W=canvas3d.width,H=canvas3d.height; ctx3d.clearRect(0,0,W,H); const cx=W/2, cy=H*0.48; const scale=Math.min(W,H)*0.42; yaw+=0.02; const light={x:Math.cos(yaw+1), y:-0.2, z:Math.sin(yaw+1)}; const slices=60; for(let i=0;i<profile.length-1;i++){const y1=cy+(profile[i].y-0.5)*scale*1.4; const y2=cy+(profile[i+1].y-0.5)*scale*1.4; for(let j=0;j<slices;j++){const a1=(j/slices)*Math.PI*2+yaw; const a2=((j+1)/slices)*Math.PI*2+yaw; const r1=profile[i].r*scale; const r2=profile[i+1].r*scale; const x11=cx+Math.cos(a1)*r1*0.7; const x12=cx+Math.cos(a2)*r1*0.7; const x21=cx+Math.cos(a1)*r2*0.7; const x22=cx+Math.cos(a2)*r2*0.7; const nx=(Math.cos(a1)+Math.cos(a2))/2; const nz=(Math.sin(a1)+Math.sin(a2))/2; const ny=(y2-y1)/scale; const ndotl=Math.max(0.05,(nx*light.x+ny*light.y+nz*light.z)); const shade=Math.floor(160+65*ndotl); ctx3d.fillStyle=`rgb(${shade}, ${shade+12}, ${shade+20})`; ctx3d.beginPath(); ctx3d.moveTo(x11,y1); ctx3d.lineTo(x12,y1); ctx3d.lineTo(x22,y2); ctx3d.lineTo(x21,y2); ctx3d.closePath(); ctx3d.fill(); }} const h=+$('#height').value||0, wc=+$('#waist').value||0; const whtr=(h&&wc)?(wc/h):0.5; const riskColor=(whtr>=0.6)?'#dc2626':(whtr>=0.5?'#d97706':'#16a34a'); ctx3d.strokeStyle=riskColor; ctx3d.lineWidth=3; const waistIdx=Math.floor(profile.length*0.5); const rr=profile[waistIdx].r*scale*0.7; ctx3d.beginPath(); ctx3d.ellipse(cx,cy,rr,rr*0.35,0,0,Math.PI*2); ctx3d.stroke(); rafId=requestAnimationFrame(loop3D); }
    enable3d?.addEventListener('change',()=>{ if(enable3d.checked){ const s=$('#sex').value||'male', h=+$('#height').value||0, w=+$('#weight').value||0, wc=+$('#waist').value||0; const bmi=(h&&w)?BMI(w,h):22, whtr=(h&&wc)?WHtR(wc,h):0.5; start3D(s,bmi,whtr);} else { stop3D(); }});
  </script>
</body>
</html>
