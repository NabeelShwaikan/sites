/* ===========================
   المتغيرات والثيمات
   =========================== */
:root{
  --bg:#f1f5f9;            /* خلفية عامة */
  --panel:#ffffff;         /* بطاقات/ألواح */
  --text:#0f172a;          /* نص أساسي */
  --muted:#475569;         /* نص ثانوي */
  --border:#e5e7eb;        /* حدود */
  --accent:#0ea5e9;        /* زر أساسي */
  --accent-2:#0369a1;      /* حد/تباين للزر */
  --leaf:#10b981;          /* لون فرعي أخضر */
  --fruit:#22c55e;         /* أخضر فاتح */
  --ground:#e2e8f0;        /* أرضية الشجرة */

  /* بيضاوي الاسم */
  --namebg:#065f46;        /* أخضر داكن */
  --namefg:#ffffff;        /* نص أبيض */

  /* حالات تفاعل */
  --focus:#22d3ee33;       /* ظل تركيز */
}
[data-theme="dark"]{
  --bg:#0b1220;
  --panel:#0f172a;
  --text:#e5e7eb;
  --muted:#cbd5e1;
  --border:#334155;
  --accent:#38bdf8;
  --accent-2:#0891b2;
  --leaf:#22c55e;
  --fruit:#16a34a;
  --ground:#111827;

  --namebg:#065f46;
  --namefg:#ffffff;
}

/* ===========================
   أساسيات
   =========================== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:"Almarai",system-ui,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:var(--text);
  line-height:1.6;
}
button, input, select, textarea, dialog, .dlg{
  font-family:"Almarai",system-ui,Segoe UI,Roboto,sans-serif;
}

/* ===========================
   ترويسة وأدوات
   =========================== */
.top{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 12px;background:var(--panel);border-bottom:1px solid var(--border)
}
.brand{font-weight:800}
.toolbar{display:flex;gap:8px;flex-wrap:wrap}

/* ===========================
   أزرار وتبويبات
   =========================== */
.btn{
  padding:10px 12px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  border-radius:12px;
  cursor:pointer;
  transition:filter .15s ease, background .15s ease, color .15s ease, border-color .15s ease;
}
.btn:hover{filter:brightness(1.03)}
.btn:active{transform:translateY(0.5px)}
.btn:disabled{opacity:.55; cursor:not-allowed}
.btn.primary{
  background:var(--accent);
  border-color:var(--accent-2);
  color:#001018; /* نص داكن على زر فاتح */
}
/* تحسين واضح للوضع الليلي */
[data-theme="dark"] .btn{ color:var(--text); background:#0f172a; border-color:#334155; }
[data-theme="dark"] .btn.primary{ color:#0b1220; background:var(--accent); border-color:var(--accent-2); }

/* تبويبات */
.tab{
  padding:10px 12px;border:1px solid var(--border);
  background:var(--panel);color:var(--text);
  border-radius:12px;cursor:pointer
}
.tab.active{border-color:var(--accent);outline:2px solid var(--focus)}
[data-theme="dark"] .tab{background:#0f172a;border-color:#334155}

/* ===========================
   لوحات وتخطيط
   =========================== */
.panel{
  background:var(--panel);border:1px solid var(--border);
  border-radius:14px;margin:12px
}
.tools{
  display:flex;gap:8px;align-items:center;
  padding:10px;border-bottom:1px solid var(--border);
  position:relative;z-index:2
}
.grid{display:grid;grid-template-columns:1fr 340px;gap:12px}
@media (max-width:1100px){.grid{grid-template-columns:1fr}}
.canvas{position:relative;overflow:auto;padding:8px;z-index:0}
.side{padding:12px}

/* حقول/نصوص */
.big{font-weight:800;font-size:18px}
.muted{color:var(--muted)}
.chips{margin-top:8px}
.chip{
  display:inline-block;background:#f8fafc;border:1px solid var(--border);
  border-radius:999px;padding:6px 10px;margin-inline-end:6px;
  font-size:13px;color:var(--muted)
}
[data-theme="dark"] .chip{background:#0b1220;border-color:#334155;color:#cbd5e1}
.grow{flex:1}

/* ===========================
   SVG (الشجرة)
   =========================== */
svg{user-select:none; -webkit-user-select:none; touch-action:manipulation}
.ground{fill:var(--ground)}
/* لا تجعل الفروع تلتقط النقرات حتى يصل النقر للأسماء */
#branches { pointer-events: none; }

/* بيضاوية الاسم الخضراء */
.nameBadge { cursor: pointer; }
.nameBadge text{
  fill: var(--namefg);
  font-weight:800;
  font-size:13px;
  dominant-baseline:middle;
  text-anchor:middle
}
.nameBadge rect{
  fill: var(--namebg);
  stroke: rgba(255,255,255,.12);
  stroke-width:1;
}

/* ===========================
   شريط الزووم
   =========================== */
.zoombar{display:flex;gap:6px}

/* ===========================
   حوار الإضافة/التعديل
   =========================== */
dialog{
  border:none;border-radius:14px;padding:0;
  max-width:560px;width:92%
}
dialog::backdrop{background:rgba(0,0,0,.55)}
.dlg{
  background:var(--panel);color:var(--text);
  border:1px solid var(--border);border-radius:14px
}
.dlg header{padding:12px 14px;border-bottom:1px solid var(--border);font-weight:800}
.dlg .body{padding:12px 14px;display:grid;gap:8px}
.dlg footer{display:flex;gap:8px;justify-content:flex-end;padding:12px 14px;border-top:1px solid var(--border)}
.input,.select{
  padding:10px;border:1px solid var(--border);
  border-radius:10px;background:transparent;color:var(--text)
}
.input:focus,.select:focus{outline:2px solid var(--focus)}
.error{color:#dc2626;font-size:12px;display:none}

/* ===========================
   جدول البيانات
   =========================== */
.tableWrap{overflow:auto}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid var(--border);padding:8px;text-align:start}

/* ===========================
   التوست (إظهار المعرّف)
   =========================== */
.toast{
  position: fixed;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  background: #111827;
  color: #fff;
  padding: 10px 14px;
  border-radius: 12px;
  font-size: 14px;
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
  z-index: 9999;
}
.toast.show{ opacity: 1; }
[data-theme="dark"] .toast{
  background: #0b1220;
  color: #e5e7eb;
}

/* ===========================
   التلميح عند خلو البيانات
   =========================== */
.emptyHint{
  position:absolute; inset:0; display:none;
  place-items:center; pointer-events:none;
}
.emptyHint > div{
  background:var(--panel); color:var(--muted);
  border:1px solid var(--border); border-radius:14px;
  padding:14px 16px; text-align:center;
}

/* ===========================
   طباعة
   =========================== */
@page{size:A4 landscape;margin:10mm}
@media print{
  .top,.tools,#page-data,#page-settings{display:none!important}
  .panel{border:none; box-shadow:none}
}
