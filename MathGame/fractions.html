<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ© ÙˆØ§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ© â€” Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</title>

  <!-- Ø®Ø· Cairo -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0f172a;
      --panel:#0b1220;
      --b:#1f2937;
      --fg:#e5e7eb;
      --muted:#a3b2c7;
      --acc:#22d3ee;
      --acc2:#0891b2;
      --good:#22c55e;
      --bad:#ef4444;
      --shadow:0 16px 40px rgba(2,6,23,.35);

      /* ÙƒØ³ÙˆØ± Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ© */
      --slice:#f97316;
      --slice-dim:#334155;
      --slice-stroke:#020617;
      --glow:#f59e0b;

      /* ÙƒØ³ÙˆØ± Ø¹Ø´Ø±ÙŠØ© */
      --fill:#22c55e;
      --fill-dim:#0f172a;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1000px 700px at 20% -10%,rgba(56,189,248,.12),transparent),
        radial-gradient(900px 600px at 90% 110%,rgba(167,139,250,.14),transparent),
        var(--bg);
      color:var(--fg);
      font-family:"Cairo",system-ui,Segoe UI,Arial;
    }

    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    .topbar{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-bottom:10px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand h1{margin:0;font-weight:900;font-size:22px}
    .actions{display:flex;gap:8px;align-items:center}

    .btn,.btn-sm,.back{
      border:1px solid var(--b);
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
      color:var(--fg); padding:10px 14px; border-radius:14px; font-weight:800; cursor:pointer;
      text-decoration:none; display:inline-block;
    }
    .btn-sm{padding:8px 12px;border-radius:12px;font-size:13px}
    .btn:hover,.btn-sm:hover{filter:brightness(1.08)}
    .btn.acc{border-color:#0891b2; box-shadow:0 0 12px rgba(8,145,178,.35)}
    .back{border-color:#f59e0b; box-shadow:0 0 12px rgba(245,158,11,.3)}

    .stage{
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0));
      border:1px solid var(--b); border-radius:20px; box-shadow:var(--shadow);
      padding:18px; min-height:560px; display:grid; grid-template-rows:auto auto auto 1fr; gap:14px; overflow:hidden
    }

    .mode-main{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .mode-main .on{outline:2px solid var(--acc);}
    .mode-sub{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
    .mode-sub.hidden{display:none;}

    .row{display:flex;align-items:center;gap:10px}
    .msg{justify-content:center;text-align:center}
    .msg.hint{color:var(--muted);font-weight:700}
    .msg.ok{color:var(--good);font-weight:900}
    .msg.bad{color:var(--bad);font-weight:900}

    .pill{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02)); border:1px solid var(--b); padding:8px 12px; border-radius:999px; font-weight:700;font-size:13px}
    .result{justify-content:center;gap:8px;flex-wrap:wrap}

    .question{
      display:flex;justify-content:center;align-items:center;gap:24px;flex-wrap:wrap;
      min-height:240px; text-align:center; font-weight:900;
    }

    .shape-wrap{
      display:flex;flex-direction:column;align-items:center;gap:8px;
    }

    .pizza,.bar-shape,.grid-shape,.line-shape,
    .grid10,.bar-dec{
      filter:drop-shadow(0 12px 28px rgba(0,0,0,.35));
      transition:transform .15s ease;
    }
    .pizza:hover,.bar-shape:hover,.grid-shape:hover,.line-shape:hover,
    .grid10:hover,.bar-dec:hover{
      transform:scale(1.02);
    }

    .glow-ring{box-shadow:0 0 0 0 rgba(245,158,11,0.0);animation:glow 1s ease-out forwards;}
    @keyframes glow {
      0%{ box-shadow:0 0 0 0 rgba(245,158,11,.0) }
      30%{ box-shadow:0 0 0 18px rgba(245,158,11,.18) }
      100%{ box-shadow:0 0 0 0 rgba(245,158,11,0) }
    }

    .options{
      display:flex; gap:12px; flex-wrap:wrap; justify-content:center; align-items:center;
    }
    .opt{
      border:none; background:none; padding:0; cursor:pointer;
    }
    .opt .box{
      min-width:130px; height:86px; border-radius:18px; border:1px solid var(--b);
      background:linear-gradient(180deg,#1d4ed8,#1e2937);
      color:#fff; font-weight:900; font-size:30px;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 12px 34px rgba(0,0,0,.28);
      transition: transform .12s ease;
    }
    .opt:hover .box{ transform: translateY(-2px) }
    .opt.c2 .box{background:linear-gradient(180deg,#16a34a,#1e2937)}
    .opt.c3 .box{background:linear-gradient(180deg,#f59e0b,#1e2937)}
    .opt.c4 .box{background:linear-gradient(180deg,#9333ea,#1e2937)}
    .opt.c5 .box{background:linear-gradient(180deg,#06b6d4,#1e2937)}

    .badge{font-size:15px;color:var(--muted);font-weight:700}

    .frac-text{
      display:inline-flex;align-items:center;gap:2px;font-size:26px;
    }
    .frac-text span{
      display:inline-block;min-width:22px;text-align:center;
    }

    #confettiLayer{pointer-events:none;position:fixed;inset:0;overflow:hidden;z-index:10}

    @keyframes pop {
      0%{ transform: scale(.6); opacity:.0 }
      100%{ transform: scale(1); opacity:1 }
    }

    /* Ø¥Ø¶Ø§ÙØ§Øª ØªØ¨ÙˆÙŠØ¨ ØªÙ…Ø§Ø±ÙŠÙ† Ø¬Ù…Ø¹ ÙˆØ·Ø±Ø­ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ© */
    .ex-big{
      font-size:26px;
      font-weight:900;
      text-align:center;
      margin-bottom:8px;
    }
    .ex-input-group{
      display:flex;flex-wrap:wrap;gap:8px;justify-content:center;align-items:center;margin-top:6px;
    }
    .ex-input-group input{
      padding:8px 10px;border-radius:12px;border:1px solid var(--b);
      background:#020617;color:var(--fg);min-width:110px;text-align:center;
      font-family:inherit;font-size:18px;
    }
    .chips-row{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;
      font-size:13px;color:var(--muted);margin-top:6px;
      justify-content:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" stroke="#22d3ee" stroke-width="2"/><path d="M8 12h8M12 8v8" stroke="#a78bfa" stroke-width="2" stroke-linecap="round"/></svg>
        <h1>Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ© ÙˆØ§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ©</h1>
      </div>
      <div class="actions">
        <button class="btn back" type="button" onclick="window.location.href='./index.html'">ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      </div>
    </div>

    <div class="stage">
      <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div>
        <div class="mode-main">
          <button id="tabFractions" class="btn-sm on">ğŸ• Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©</button>
          <button id="tabDecimals"  class="btn-sm">ğŸ”¢ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ©</button>
          <button id="btnNew"       class="btn-sm acc">ğŸ”„ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</button>
          <button id="btnVoice"     class="btn-sm" onclick="toggleVoice()">ğŸ”ˆ ØµÙˆØª: ÙŠØ¹Ù…Ù„</button>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ ÙØ±Ø¹ÙŠ: Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ© -->
        <div id="subFractions" class="mode-sub">
          <button id="btnFLearn"   class="btn-sm on">ğŸ• ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ³Ø±</button>
          <button id="btnFCompare" class="btn-sm">âš–ï¸ Ù‚Ø§Ø±Ù† Ø§Ù„ÙƒØ³ÙˆØ±</button>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ ÙØ±Ø¹ÙŠ: Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ© -->
        <div id="subDecimals" class="mode-sub hidden">
          <button id="btnDValue"   class="btn-sm on">ğŸ“Š Ù…Ø«Ù‘Ù„ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠ</button>
          <button id="btnDMatch"   class="btn-sm">ğŸ” ÙƒØ³Ø± â†” Ø¹Ø¯Ø¯ Ø¹Ø´Ø±ÙŠ</button>
          <button id="btnDAddSub"  class="btn-sm">ğŸ§® Ø¬Ù…Ø¹ ÙˆØ·Ø±Ø­ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ©</button>
        </div>
      </div>

      <div class="row msg hint" id="message">Ø§Ø®ØªØ± Ø§Ù„Ù†Ø´Ø§Ø· Ø«Ù… Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ§ Ø¨Ø·Ù„! ğŸŒŸ</div>

      <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ -->
      <div id="questionArea" class="question"></div>

      <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª -->
      <div id="options" class="options"></div>

      <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
      <div class="row result">
        <div class="pill">Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span id="tries">0</span></div>
        <div class="pill">Ø³Ù„Ø³Ù„Ø© ØµØ­ÙŠØ­Ø©: <span id="streak">0</span></div>
        <div class="pill">Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø©: <span id="best">0</span></div>
      </div>

      <div id="confettiLayer"></div>
    </div>
  </div>

  <script>
    /************ Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø© ************/
    let bigMode   = 'fractions'; // 'fractions' | 'decimals'
    let fracMode  = 'learn';     // 'learn' | 'compare'
    let decMode   = 'value';     // 'value' | 'match' | 'ops'

    let voiceOn = true;
    let currentAnswer = null; // ÙƒØ³ÙˆØ±: "a/b" Ø£Ùˆ Ø±Ù‚Ù… Ù…ÙÙ‚ÙˆØ¯Ø› Ø¹Ø´Ø±ÙŠØ©: "0.5"Ø› Ù…Ù‚Ø§Ø±Ù†Ø©: 'left'|'right'|'equal'
    let tries = 0, streak = 0, best = 0;
    let currentOp = null; // '+' Ø£Ùˆ '-' ÙÙŠ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¹Ø´Ø±ÙŠØ©

    const msgEl       = document.getElementById('message');
    const qArea       = document.getElementById('questionArea');
    const optsEl      = document.getElementById('options');
    const btnNew      = document.getElementById('btnNew');
    const btnVoice    = document.getElementById('btnVoice');
    const triesEl     = document.getElementById('tries');
    const streakEl    = document.getElementById('streak');
    const bestEl      = document.getElementById('best');

    const tabFractions= document.getElementById('tabFractions');
    const tabDecimals = document.getElementById('tabDecimals');
    const subFractions= document.getElementById('subFractions');
    const subDecimals = document.getElementById('subDecimals');

    const btnFLearn   = document.getElementById('btnFLearn');
    const btnFCompare = document.getElementById('btnFCompare');
    const btnDValue   = document.getElementById('btnDValue');
    const btnDMatch   = document.getElementById('btnDMatch');
    const btnDAddSub  = document.getElementById('btnDAddSub');

    /************ Ø£Ø¯ÙˆØ§Øª ************/
    function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
    function colorClass(i){ return ['c1','c2','c3','c4','c5'][i%5]; }

    // Ù„ÙˆØ­Ø§Øª Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©
    const PALETTES = [
      {slice:'#f97316', sliceDim:'#334155'},
      {slice:'#22c55e', sliceDim:'#1f2937'},
      {slice:'#e11d48', sliceDim:'#1e293b'},
      {slice:'#06b6d4', sliceDim:'#020617'},
      {slice:'#facc15', sliceDim:'#1f2937'}
    ];
    function applyRandomPalette(){
      const p = pick(PALETTES);
      document.documentElement.style.setProperty('--slice', p.slice);
      document.documentElement.style.setProperty('--slice-dim', p.sliceDim);
    }

    /************ ØµÙˆØª Ø¨Ø¯ÙˆÙ† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ************/
    let __arVoice = null;
    function __pickArabicVoice(){
      const voices = window.speechSynthesis?.getVoices?.() || [];
      return voices.find(v => v.lang?.toLowerCase().startsWith('ar'))
          || voices.find(v => /ar|sa|eg|ma|ae|jo|tn/i.test(v.lang||'')) || null;
    }
    function __stripEmojiAndSymbols(s){
      let t = String(s);
      t = t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g, '');
      t = t.replace(/[\u200D\uFE0F]/g, '');
      t = t.replace(/[^ \u0600-\u06FF0-9\.\!\?ØŒØŸ\-]/g, '');
      t = t.replace(/^[^\u0600-\u06FF0-9]+/, '');
      t = t.replace(/\s{2,}/g, ' ').trim();
      return t;
    }
    function __voiceTune(u, tone){
      if(tone === 'ok'){ u.rate = 1.05; u.pitch = 1.05; u.volume = 1.0; }
      else if(tone === 'bad'){ u.rate = 0.95; u.pitch = 0.9; u.volume = 0.95; }
    }
    function speak(msg, tone){
      try{
        if(!voiceOn || !window.speechSynthesis) return;
        const t = __stripEmojiAndSymbols(msg);
        if(!t) return;
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'ar';
        if(!__arVoice){
          __arVoice = __pickArabicVoice();
          if(!__arVoice){
            window.speechSynthesis.onvoiceschanged = () => { __arVoice = __pickArabicVoice(); };
          }
        }
        if(__arVoice) u.voice = __arVoice;
        __voiceTune(u, tone);
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }catch(e){}
    }
    function toggleVoice(){
      voiceOn = !voiceOn;
      btnVoice.textContent = voiceOn ? 'ğŸ”ˆ ØµÙˆØª: ÙŠØ¹Ù…Ù„' : 'ğŸ”‡ ØµÙˆØª: Ù…ØªÙˆÙ‚Ù';
    }

    function playSuccess(){ try{ new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_84e61fce5c.mp3").play(); }catch(e){} }
    function playClickBad(){ try{ const a=new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_1b7a1c4f8a.mp3"); a.volume=.8; a.play(); }catch(e){} }

    function confettiOnce(){
      const layer = document.getElementById('confettiLayer');
      for(let i=0;i<20;i++){
        const c = document.createElement('i');
        c.style.position='fixed';
        c.style.left = Math.random()*100 + '%';
        c.style.top  = '-20px';
        c.style.width='8px'; c.style.height='14px';
        c.style.background=`hsl(${Math.random()*360},90%,60%)`;
        c.style.borderRadius='2px';
        c.style.transform=`rotate(${Math.random()*180}deg)`;
        c.style.opacity='0.9';
        c.style.transition='transform 2s linear, top 2s linear, opacity 2.1s ease-out';
        layer.appendChild(c);
        const endTop = 100 + Math.random()*20;
        requestAnimationFrame(()=>{
          c.style.top = endTop+'vh';
          c.style.transform = `rotate(${360+Math.random()*180}deg)`;
          c.style.opacity='0.1';
        });
        setTimeout(()=>c.remove(), 2300+Math.random()*400);
      }
    }

    /************ Ø±Ø³Ù… Ø§Ù„Ø£Ø´ÙƒØ§Ù„ â€” Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ© ************/
    function polarToXY(cx, cy, r, angleRad){
      return { x: cx + r * Math.cos(angleRad), y: cy + r * Math.sin(angleRad) };
    }

    function pizzaSVG(numer, denom){
      const size = 220, cx=size/2, cy=size/2, r = size*0.42;
      const step = (Math.PI*2)/denom;
      let paths = '';
      for(let i=0;i<denom;i++){
        const a0 = -Math.PI/2 + i*step;
        const a1 = a0 + step;
        const p0 = polarToXY(cx,cy,r,a0);
        const p1 = polarToXY(cx,cy,r,a1);
        const largeArc = step > Math.PI ? 1 : 0;
        const filled = i < numer;
        const fill = filled ? 'var(--slice)' : 'var(--slice-dim)';
        const delay = i*20;
        paths += `
          <path d="M ${cx} ${cy} L ${p0.x} ${p0.y} A ${r} ${r} 0 ${largeArc} 1 ${p1.x} ${p1.y} Z"
                fill="${fill}" stroke="var(--slice-stroke)" stroke-width="3"
                style="transform-origin:${cx}px ${cy}px; animation:pop .35s ease ${delay}ms both"></path>`;
      }
      return `
        <svg class="pizza" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
          <circle cx="${cx}" cy="${cy}" r="${r+10}" fill="#b45309" opacity=".5"></circle>
          <circle cx="${cx}" cy="${cy}" r="${r+6}" fill="#f59e0b" opacity=".7"></circle>
          ${paths}
        </svg>
      `;
    }

    function barSVG(numer, denom){
      const width=260, height=60, pad=6;
      const segW = (width - 2*pad)/denom;
      let rects='';
      for(let i=0;i<denom;i++){
        const filled = i < numer;
        const fill = filled ? 'var(--slice)' : 'var(--slice-dim)';
        const x = pad + i*segW;
        const delay = i*15;
        rects += `
          <rect x="${x}" y="${pad}" width="${segW-2}" height="${height-2*pad}" rx="6" ry="6"
                fill="${fill}" stroke="var(--slice-stroke)" stroke-width="2"
                style="animation:pop .25s ease ${delay}ms both"></rect>`;
      }
      return `
        <svg class="bar-shape" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
          <rect x="2" y="${height/2}" width="${width-4}" height="${height/3}" rx="10" ry="10"
                fill="#020617" opacity=".45"></rect>
          ${rects}
        </svg>
      `;
    }

    function layoutForDenom(denom){
      const table = {
        2:[1,2],3:[1,3],4:[2,2],5:[1,5],6:[2,3],8:[2,4],10:[2,5],12:[3,4]
      };
      return table[denom] || [1,denom];
    }
    function gridSVG(numer, denom){
      const [rows,cols] = layoutForDenom(denom);
      const size = 220, pad=16;
      const cellW = (size-2*pad)/cols;
      const cellH = (size-2*pad)/rows;
      let rects='';
      for(let i=0;i<denom;i++){
        const r = Math.floor(i/cols);
        const c = i % cols;
        const x = pad + c*cellW;
        const y = pad + r*cellH;
        const filled = i < numer;
        const fill = filled ? 'var(--slice)' : 'var(--slice-dim)';
        const delay = (r*cols+c)*15;
        rects += `
          <rect x="${x}" y="${y}" width="${cellW-3}" height="${cellH-3}" rx="4" ry="4"
                fill="${fill}" stroke="var(--slice-stroke)" stroke-width="2"
                style="animation:pop .25s ease ${delay}ms both"></rect>`;
      }
      return `
        <svg class="grid-shape" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
          <rect x="8" y="8" width="${size-16}" height="${size-16}" rx="18" ry="18"
                fill="#020617" opacity=".45"></rect>
          ${rects}
        </svg>
      `;
    }

    function lineSVG(numer, denom){
      const width=260, height=70;
      const pad=30;
      const y = height/2;
      let ticks='';
      for(let i=0;i<=denom;i++){
        const x = pad + (width-2*pad)*i/denom;
        ticks += `<line x1="${x}" y1="${y-6}" x2="${x}" y2="${y+6}" stroke="#e5e7eb" stroke-width="2"></line>`;
      }
      const xPoint = pad + (width-2*pad)*numer/denom;
      return `
        <svg class="line-shape" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
          <line x1="${pad}" y1="${y}" x2="${width-pad}" y2="${y}" stroke="#e5e7eb" stroke-width="3" />
          ${ticks}
          <circle cx="${xPoint}" cy="${y}" r="7" fill="var(--slice)" stroke="var(--slice-stroke)" stroke-width="2"
                  style="animation:pop .3s ease 0ms both"></circle>
          <text x="${pad-10}" y="${y+24}" fill="#e5e7eb" font-size="14">0</text>
          <text x="${width-pad-4}" y="${y+24}" fill="#e5e7eb" font-size="14">1</text>
        </svg>
      `;
    }

    function randomShape(numer, denom){
      const types = ['pizza','bar','grid','line'];
      const t = pick(types);
      if(t==='pizza') return { html:pizzaSVG(numer,denom), label:'Ø¯Ø§Ø¦Ø±Ø© (Ø¨ÙŠØªØ²Ø§)' };
      if(t==='bar')   return { html:barSVG(numer,denom),   label:'Ø´Ø±ÙŠØ· ÙƒØ³Ø±ÙŠ' };
      if(t==='grid')  return { html:gridSVG(numer,denom),  label:'Ù„ÙˆØ­ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©' };
      return { html:lineSVG(numer,denom), label:'Ø®Ø· Ø£Ø¹Ø¯Ø§Ø¯' };
    }

    /************ ØªÙˆÙ„ÙŠØ¯ ÙƒØ³ÙˆØ± Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ© ************/
    const DENOMS = [2,3,4,4,4,6,6,8,8];
    function randomFraction(){
      const d = pick(DENOMS);
      const n = randInt(1,d-1);
      return {n,d};
    }
    function fracToStr(n,d){ return `${n}/${d}`; }
    function simplify(n,d){
      function gcd(a,b){ return b?gcd(b,a%b):a; }
      const g=gcd(n,d); return [n/g,d/g];
    }
    function equivalentFraction(n,d){
      const k = pick([2,3,4]);
      return {n:n*k,d:d*k};
    }
    function compareFractions(a,b,c,d){
      const left = a*d, right = c*b;
      if(left>right) return 'left';
      if(left<right) return 'right';
      return 'equal';
    }

    /************ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©: ØªØ¹Ø±Ù‘Ù/Ù…ÙƒØ§ÙØ¦/Ø¬Ø²Ø¡ Ù…ÙÙ‚ÙˆØ¯ ************/
    function renderFractionsLearn(){
      // name (ØªØ¹Ø±Ù), equiv (Ù…ÙƒØ§ÙØ¦), missing (Ø¬Ø²Ø¡ Ù…ÙÙ‚ÙˆØ¯)
      const r = Math.random();
      const qType = r < 0.5 ? 'name' : (r < 0.8 ? 'equiv' : 'missing');

      const base = randomFraction();
      const numer=base.n, denom=base.d;
      const baseStr = fracToStr(numer,denom);

      optsEl.innerHTML = '';

      if(qType === 'name'){
        currentAnswer = baseStr;
        const shape = randomShape(numer,denom);
        qArea.innerHTML = `
          <div class="shape-wrap">
            ${shape.html}
            <div class="badge">${numer} Ù…Ù† ${denom} Ø¬Ø²Ø¡Ù‹Ø§ Ù…Ù„ÙˆÙ‘Ù†Ù‹Ø§</div>
          </div>
        `;
        const opts = new Set([baseStr]);
        while(opts.size<4){
          const f = randomFraction();
          opts.add(fracToStr(f.n,f.d));
        }
        const arr = shuffle([...opts]);
        arr.forEach((txt,i)=>{
          const btn = document.createElement('button');
          btn.className = `opt ${colorClass(i)}`;
          btn.innerHTML = `<div class="box">${txt}</div>`;
          btn.onclick = ()=>onPick(txt,btn);
          optsEl.appendChild(btn);
        });
        msgEl.className='row msg hint';
        msgEl.textContent='Ø§Ø®ØªØ± Ø§Ù„ÙƒØ³Ø± Ø§Ù„Ø°ÙŠ ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ù„ÙˆÙ‘Ù†Ø©.';

      }else if(qType === 'equiv'){
        const [sn,sd] = simplify(numer,denom);
        const equiv = equivalentFraction(sn,sd);
        currentAnswer = fracToStr(equiv.n,equiv.d);

        const shape1 = randomShape(sn,sd);
        const shape2 = randomShape(equiv.n,equiv.d);

        qArea.innerHTML = `
          <div style="display:flex;gap:24px;align-items:center;justify-content:center;flex-wrap:wrap">
            <div class="shape-wrap">
              ${shape1.html}
              <div class="badge">Ø§Ù„ÙƒØ³Ø±: ${sn}/${sd}</div>
            </div>
            <div style="opacity:.8;font-size:26px">â†”</div>
            <div class="shape-wrap">
              ${shape2.html}
              <div class="badge">Ø§Ø®ØªØ± ÙƒØ³Ø±Ù‹Ø§ Ù…ÙƒØ§ÙØ¦Ù‹Ø§ Ù„Ù‡</div>
            </div>
          </div>
        `;

        const opts = new Set([currentAnswer]);
        while(opts.size<4){
          const choiceType = Math.random()<0.5?'equiv':'random';
          if(choiceType==='equiv'){
            const f = equivalentFraction(sn,sd);
            opts.add(fracToStr(f.n,f.d));
          }else{
            const f = randomFraction();
            const [fn,fd] = simplify(f.n,f.d);
            if(fn!==sn || fd!==sd) opts.add(fracToStr(f.n,f.d));
          }
        }
        const arr = shuffle([...opts]);
        arr.forEach((txt,i)=>{
          const btn = document.createElement('button');
          btn.className = `opt ${colorClass(i)}`;
          btn.innerHTML = `<div class="box">${txt}</div>`;
          btn.onclick = ()=>onPick(txt,btn);
          optsEl.appendChild(btn);
        });

        msgEl.className='row msg hint';
        msgEl.textContent='Ø§Ø®ØªØ± Ø§Ù„ÙƒØ³Ø± Ø§Ù„Ù…ÙƒØ§ÙØ¦ (ÙŠÙ…Ø«Ù‘Ù„ Ù†ÙØ³ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ù„ÙˆÙ‘Ù†).';

      }else{ // missing: Ø¬Ø²Ø¡ Ù…ÙÙ‚ÙˆØ¯
        const hideNumerator = Math.random() < 0.7;
        const shape = randomShape(numer,denom);

        let fracHTML;
        if(hideNumerator){
          currentAnswer = String(numer);
          fracHTML = `
            <span class="frac-text">
              <span>ØŸ</span><span>/</span><span>${denom}</span>
            </span>
          `;
        }else{
          currentAnswer = String(denom);
          fracHTML = `
            <span class="frac-text">
              <span>${numer}</span><span>/</span><span>ØŸ</span>
            </span>
          `;
        }

        qArea.innerHTML = `
          <div class="shape-wrap">
            ${shape.html}
            <div class="badge">Ø£ÙƒÙ…Ù„ Ø§Ù„ÙƒØ³Ø± Ø§Ù„Ù…ÙÙ‚ÙˆØ¯:</div>
            <div>${fracHTML}</div>
          </div>
        `;

        const opts = new Set([currentAnswer]);
        while(opts.size<4){
          let cand = currentAnswer === String(numer)
            ? Math.max(1, numer + pick([-2,-1,1,2]))
            : Math.max(2, denom + pick([-2,-1,1,2]));
          opts.add(String(cand));
        }
        const arr = shuffle([...opts]);
        arr.forEach((txt,i)=>{
          const btn = document.createElement('button');
          btn.className = `opt ${colorClass(i)}`;
          btn.innerHTML = `<div class="box">${txt}</div>`;
          btn.onclick = ()=>onPick(txt,btn);
          optsEl.appendChild(btn);
        });

        msgEl.className='row msg hint';
        msgEl.textContent='Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØµØ­ÙŠØ­ Ù„ÙŠÙƒØªÙ…Ù„ Ø§Ù„ÙƒØ³Ø±.';
      }
    }

    function renderFractionsCompare(){
      let f1 = randomFraction();
      let f2 = randomFraction();
      if(compareFractions(f1.n,f1.d,f2.n,f2.d)==='equal'){
        f2 = randomFraction();
      }
      const ans = compareFractions(f1.n,f1.d,f2.n,f2.d);
      currentAnswer = ans; // 'left' | 'right' | 'equal'

      const shapeL = randomShape(f1.n,f1.d);
      const shapeR = randomShape(f2.n,f2.d);

      qArea.innerHTML = `
        <div style="display:flex;gap:24px;align-items:center;justify-content:center;flex-wrap:wrap">
          <div id="shapeL" class="shape-wrap">
            ${shapeL.html}
            <div class="badge">${f1.n}/${f1.d}</div>
          </div>
          <div style="opacity:.8;font-size:28px">â†”</div>
          <div id="shapeR" class="shape-wrap">
            ${shapeR.html}
            <div class="badge">${f2.n}/${f2.d}</div>
          </div>
        </div>
        <div class="badge">Ø£ÙŠ Ø§Ù„ÙƒØ³Ø±ÙŠÙ† Ø£ÙƒØ¨Ø±ØŸ</div>
      `;

      optsEl.innerHTML = '';
      const choices = [
        {key:'left',  label:'Ø§Ù„Ø£ÙŠØ³Ø± Ø£ÙƒØ¨Ø±'},
        {key:'equal', label:'Ù…ØªØ³Ø§ÙˆÙŠØ§Ù†'},
        {key:'right', label:'Ø§Ù„Ø£ÙŠÙ…Ù† Ø£ÙƒØ¨Ø±'}
      ];
      choices.forEach((ch,i)=>{
        const btn = document.createElement('button');
        btn.className = `opt ${colorClass(i)}`;
        btn.innerHTML = `<div class="box" style="font-size:26px">${ch.label}</div>`;
        btn.onclick = ()=>onPick(ch.key,btn);
        optsEl.appendChild(btn);
      });

      msgEl.className='row msg hint';
      msgEl.textContent='Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨ÙŠÙ† Ø§Ù„ÙƒØ³Ø±ÙŠÙ†.';
    }

    function renderFractions(){
      applyRandomPalette();
      if(fracMode==='learn') renderFractionsLearn();
      else renderFractionsCompare();
    }

    /************ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ© ************/
    // Ø´Ø¨ÙƒØ© 10Ã—10
    function grid10SVG(filled){
      const size = 220, pad=16;
      const cols=10, rows=10;
      const cellW = (size-2*pad)/cols;
      const cellH = (size-2*pad)/rows;
      let rects='';
      for(let i=0;i<100;i++){
        const r = Math.floor(i/cols);
        const c = i % cols;
        const x = pad + c*cellW;
        const y = pad + r*cellH;
        const isFilled = i < filled;
        const fill = isFilled ? 'var(--fill)' : 'var(--fill-dim)';
        const delay = (r*cols+c)*4;
        rects += `
          <rect x="${x}" y="${y}" width="${cellW-2}" height="${cellH-2}" rx="2" ry="2"
                fill="${fill}" stroke="#020617" stroke-width="1"
                style="animation:pop .25s ease ${delay}ms both"></rect>`;
      }
      return `
        <svg class="grid10" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
          <rect x="8" y="8" width="${size-16}" height="${size-16}" rx="18" ry="18"
                fill="#020617" opacity=".45"></rect>
          ${rects}
        </svg>
      `;
    }

    // Ø´Ø±ÙŠØ· Ø¹Ø´Ø±ÙŠ
    function barDecSVG(value){
      const width=260, height=60, pad=10;
      const fillW = (width-2*pad)*value;
      const step = (width-2*pad)/10;
      let ticks='';
      for(let i=0;i<=10;i++){
        const x = pad + i*step;
        ticks += `<line x1="${x}" y1="${height-18}" x2="${x}" y2="${height-10}" stroke="#e5e7eb" stroke-width="1.4"></line>`;
      }
      return `
        <svg class="bar-dec" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
          <rect x="${pad}" y="${height/3}" width="${width-2*pad}" height="${height/4}" rx="10" ry="10"
                fill="#020617" stroke="#0f172a" stroke-width="2"></rect>
          <rect x="${pad+1}" y="${height/3+1}" width="${fillW-2}" height="${height/4-2}" rx="9" ry="9"
                fill="var(--fill)" style="animation:pop .25s ease 0ms both"></rect>
          ${ticks}
          <text x="${pad-4}" y="${height-4}" fill="#e5e7eb" font-size="12">0</text>
          <text x="${width-pad-10}" y="${height-4}" fill="#e5e7eb" font-size="12">1</text>
        </svg>
      `;
    }

    const DECIMALS_POOL = [
      0.1,0.2,0.3,0.4,0.5,
      0.25,0.75,
      0.6,0.7,0.8,0.9
    ];
    function fmtDec(x){
      return Number(x.toFixed(2)).toString();
    }

    const FRACTIONS_DEC = [
      {n:1,d:2,dec:0.5},
      {n:1,d:4,dec:0.25},
      {n:3,d:4,dec:0.75},
      {n:1,d:5,dec:0.2},
      {n:2,d:5,dec:0.4},
      {n:3,d:5,dec:0.6},
      {n:1,d:10,dec:0.1},
      {n:3,d:10,dec:0.3},
      {n:7,d:10,dec:0.7}
    ];

    function renderDecValue(){
      const value = pick(DECIMALS_POOL);
      const hundred = Math.round(value*100);
      currentAnswer = fmtDec(value);

      const useGrid = value<=0.6;
      const shapeHTML = useGrid ? grid10SVG(hundred) : barDecSVG(value);

      qArea.innerHTML = `
        <div class="shape-wrap">
          ${shapeHTML}
          <div class="badge">ÙƒÙ… ÙŠØ³Ø§ÙˆÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ù„ÙˆÙ‘Ù† Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø¹Ø¯Ø¯ Ø¹Ø´Ø±ÙŠØŸ</div>
        </div>
      `;

      const opts = new Set([currentAnswer]);
      while(opts.size<4){
        let offset = pick([-0.3,-0.2,-0.1,0.1,0.2,0.3]);
        let cand = value + offset;
        if(cand<=0 || cand>=1) continue;
        cand = Number(cand.toFixed(2));
        opts.add(fmtDec(cand));
      }
      const arr = shuffle([...opts]);

      optsEl.innerHTML = '';
      arr.forEach((txt,i)=>{
        const btn = document.createElement('button');
        btn.className = `opt ${colorClass(i)}`;
        btn.innerHTML = `<div class="box">${txt}</div>`;
        btn.onclick = ()=>onPick(txt,btn);
        optsEl.appendChild(btn);
      });

      msgEl.className='row msg hint';
      msgEl.textContent='Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø«Ù‘Ù„ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ù„ÙˆÙ‘Ù†.';
    }

    function renderDecMatch(){
      const f = pick(FRACTIONS_DEC);
      currentAnswer = fmtDec(f.dec);

      const useGrid = f.d===4 || f.d===2;
      const shapeHTML = useGrid ? grid10SVG(Math.round(f.dec*100)) : barDecSVG(f.dec);

      qArea.innerHTML = `
        <div style="display:flex;gap:24px;align-items:center;justify-content:center;flex-wrap:wrap">
          <div class="shape-wrap">
            <div style="font-size:32px">${f.n}/${f.d}</div>
            <div class="badge">Ù‡Ø°Ø§ ÙƒØ³Ø± Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ</div>
          </div>
          <div style="opacity:.8;font-size:26px">â†”</div>
          <div class="shape-wrap">
            ${shapeHTML}
            <div class="badge">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø§Ù„Ù…ÙƒØ§ÙØ¦ Ù„Ù„ÙƒØ³Ø±.</div>
          </div>
        </div>
      `;

      const opts = new Set([currentAnswer]);
      while(opts.size<4){
        let cand = f.dec + pick([-0.3,-0.2,-0.1,0.1,0.2,0.3]);
        if(cand<=0 || cand>=1) continue;
        cand = Number(cand.toFixed(2));
        opts.add(fmtDec(cand));
      }
      const arr = shuffle([...opts]);

      optsEl.innerHTML = '';
      arr.forEach((txt,i)=>{
        const btn = document.createElement('button');
        btn.className = `opt ${colorClass(i)}`;
        btn.innerHTML = `<div class="box">${txt}</div>`;
        btn.onclick = ()=>onPick(txt,btn);
        optsEl.appendChild(btn);
      });

      msgEl.className='row msg hint';
      msgEl.textContent='Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø§Ù„Ù…ÙƒØ§ÙØ¦ Ù„Ù„ÙƒØ³Ø± Ø§Ù„Ù…Ø¹Ø·Ù‰.';
    }

    /* ØªÙ…Ø§Ø±ÙŠÙ† Ø¬Ù…Ø¹ ÙˆØ·Ø±Ø­ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ© */
    function normalizeDecimal(s){
      if(!s) return '';
      let n = Number(String(s).replace(',','.'));
      if(isNaN(n)) return 'NaN';
      return n.toFixed(2).replace(/0+$/,'').replace(/\.$/,'');
    }

    function renderDecOps(){
      currentOp = Math.random() < 0.5 ? '+' : '-';
      let a,b;

      if(currentOp === '+'){
        a = (randInt(1,19)/10).toFixed(1); // 0.1â€“1.9
        b = (randInt(1,19)/10).toFixed(1);
        currentAnswer = normalizeDecimal(parseFloat(a) + parseFloat(b));
      }else{
        const x = (randInt(5,19)/10).toFixed(1); // 0.5â€“1.9
        const maxY = Math.round(parseFloat(x)*10);
        const y = (randInt(1,maxY)/10).toFixed(1);
        a = x; b = y;
        currentAnswer = normalizeDecimal(parseFloat(a) - parseFloat(b));
      }

      optsEl.innerHTML = '';

      qArea.innerHTML = `
        <div class="shape-wrap">
          <div class="badge">Ø§ÙƒØªØ¨ Ù†Ø§ØªØ¬ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¹Ø´Ø±ÙŠØ©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØµÙ„Ø©.</div>
          <div class="ex-big">
            ${a} ${currentOp} ${b} = ØŸ
          </div>
          <div class="ex-input-group">
            <label for="decOpInput">Ø§ÙƒØªØ¨ Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ø¹Ø´Ø±ÙŠ:</label>
            <input id="decOpInput" type="text" placeholder="Ù…Ø«Ø§Ù„: 1.4" />
            <button class="btn-sm" type="button" onclick="checkDecOp()">âœ… ØªØ­Ù‚Ù‚</button>
          </div>
          <div class="chips-row">
            <span>ğŸ’¡ Ø±ØªÙ‘Ø¨ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ ØªØ­Øª Ø¨Ø¹Ø¶ ÙÙŠ Ø§Ù„Ø¯ÙØªØ± Ù„Ùˆ Ø­Ø§Ø¨ ØªØ³Ø§Ø¹Ø¯ Ù†ÙØ³Ùƒ.</span>
            <span>âœ… ØªØ£ÙƒÙ‘Ø¯ Ù…Ù† Ù…ÙƒØ§Ù† Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø´Ø±ÙŠØ©.</span>
          </div>
        </div>
      `;

      msgEl.className='row msg hint';
      msgEl.textContent = currentOp === '+'
        ? 'Ø­Ø§ÙˆÙ„ Ø£Ù† ØªØ¬Ù…Ø¹ Ø§Ù„Ø¹Ø¯Ø¯ÙŠÙ† Ø§Ù„Ø¹Ø´Ø±ÙŠÙŠÙ† Ø¨Ø¯Ù‚Ø©ØŒ Ø«Ù… Ø§ÙƒØªØ¨ Ø§Ù„Ù†Ø§ØªØ¬.'
        : 'Ø§Ø·Ø±Ø­ Ø§Ù„Ø¹Ø¯Ø¯ÙŠÙ† Ø§Ù„Ø¹Ø´Ø±ÙŠÙŠÙ†ØŒ Ù…Ø¹ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ù„Ø­ÙØ¸ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø¹Ø´Ø±ÙŠØ©.';
    }

    function checkDecOp(){
      const inp = document.getElementById('decOpInput');
      if(!inp) return;
      tries++; triesEl.textContent = tries;

      const user = normalizeDecimal(inp.value);
      const correct = normalizeDecimal(currentAnswer);

      if(user === correct){
        streak++; if(streak>best){best=streak; bestEl.textContent=best;}
        streakEl.textContent = streak;

        msgEl.className='row msg ok';
        msgEl.textContent = 'Ø±Ø§Ø¦Ø¹! Ø­Ø³Ø¨Øª Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­. ğŸŒŸ';
        speak('Ø±Ø§Ø¦Ø¹! Ø­Ø³Ø¨Øª Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­. ğŸŒŸ','ok');
        playSuccess();
        confettiOnce();
        setTimeout(newQuestion, 900);
      }else{
        streak=0; streakEl.textContent=streak;
        msgEl.className='row msg bad';
        msgEl.textContent = 'ÙÙŠ Ø®Ø·Ø£ Ø¨Ø³ÙŠØ· ÙÙŠ Ø§Ù„Ù†Ø§ØªØ¬ØŒ Ø¬Ø±Ù‘Ø¨ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ù…Ù† Ø¬Ø¯ÙŠØ¯ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
        speak('ÙÙŠ Ø®Ø·Ø£ Ø¨Ø³ÙŠØ· ÙÙŠ Ø§Ù„Ù†Ø§ØªØ¬ØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.','bad');
        playClickBad();
      }
    }

    function renderDecimals(){
      if(decMode==='value') renderDecValue();
      else if(decMode==='match') renderDecMatch();
      else renderDecOps();
    }

    /************ ØªØ­ÙƒÙ‘Ù… Ø±Ø¦ÙŠØ³ÙŠ ************/
    function render(){
      if(bigMode==='fractions') renderFractions();
      else renderDecimals();
    }
    function newQuestion(){
      render();
    }
    btnNew.onclick = newQuestion;

    // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨ Ø±Ø¦ÙŠØ³ÙŠ
    tabFractions.onclick = ()=>{
      bigMode='fractions';
      tabFractions.classList.add('on');
      tabDecimals.classList.remove('on');
      subFractions.classList.remove('hidden');
      subDecimals.classList.add('hidden');
      msgEl.textContent = 'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ© Ø«Ù… Ø£Ø¬Ø¨ ÙŠØ§ Ø¨Ø·Ù„!';
      msgEl.className='row msg hint';
      newQuestion();
    };
    tabDecimals.onclick = ()=>{
      bigMode='decimals';
      tabDecimals.classList.add('on');
      tabFractions.classList.remove('on');
      subDecimals.classList.remove('hidden');
      subFractions.classList.add('hidden');
      msgEl.textContent = 'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø¹Ø´Ø±ÙŠØ© Ø«Ù… Ø£Ø¬Ø¨ ÙŠØ§ Ù…Ø¨Ø¯Ø¹!';
      msgEl.className='row msg hint';
      newQuestion();
    };

    // Ø£ÙˆØ¶Ø§Ø¹ ÙØ±Ø¹ÙŠØ© â€” Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©
    btnFLearn.onclick = ()=>{
      fracMode='learn';
      btnFLearn.classList.add('on');
      btnFCompare.classList.remove('on');
      newQuestion();
    };
    btnFCompare.onclick = ()=>{
      fracMode='compare';
      btnFCompare.classList.add('on');
      btnFLearn.classList.remove('on');
      newQuestion();
    };

    // Ø£ÙˆØ¶Ø§Ø¹ ÙØ±Ø¹ÙŠØ© â€” Ø¹Ø´Ø±ÙŠØ©
    btnDValue.onclick = ()=>{
      decMode='value';
      btnDValue.classList.add('on');
      btnDMatch.classList.remove('on');
      btnDAddSub.classList.remove('on');
      newQuestion();
    };
    btnDMatch.onclick = ()=>{
      decMode='match';
      btnDMatch.classList.add('on');
      btnDValue.classList.remove('on');
      btnDAddSub.classList.remove('on');
      newQuestion();
    };
    btnDAddSub.onclick = ()=>{
      decMode='ops';
      btnDAddSub.classList.add('on');
      btnDValue.classList.remove('on');
      btnDMatch.classList.remove('on');
      newQuestion();
    };

    /************ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ ************/
    function onPick(value, btn){
      tries++; triesEl.textContent = tries;
      if(value===currentAnswer){
        streak++; if(streak>best){best=streak; bestEl.textContent=best;}
        streakEl.textContent = streak;

        msgEl.className='row msg ok';
        let text;
        if(bigMode==='fractions'){
          text = fracMode==='learn'
            ? 'Ù…Ù…ØªØ§Ø²! ÙÙ‡Ù…Øª Ø§Ù„ÙƒØ³Ø± Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø±Ø§Ø¦Ø¹Ø©.'
            : 'Ø£Ø­Ø³Ù†Øª! Ù…Ù‚Ø§Ø±Ù†Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„ÙƒØ³ÙˆØ±.';
        }else{
          text = decMode==='value'
            ? 'Ø±Ø§Ø¦Ø¹! Ù‚Ø±Ø£Øª Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.'
            : 'Ù…Ù…ØªØ§Ø²! Ø±Ø¨Ø·Øª Ø¨ÙŠÙ† Ø§Ù„ÙƒØ³Ø± ÙˆØ§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠ.';
        }
        msgEl.textContent = text;
        speak(text,'ok');
        playSuccess();
        confettiOnce();

        if(bigMode==='fractions' && fracMode==='compare'){
          const L = document.querySelector('#shapeL > svg');
          const R = document.querySelector('#shapeR > svg');
          if(value==='left')  L?.classList.add('glow-ring');
          if(value==='right') R?.classList.add('glow-ring');
          if(value==='equal'){ L?.classList.add('glow-ring'); R?.classList.add('glow-ring'); }
          setTimeout(()=>{
            L?.classList.remove('glow-ring');
            R?.classList.remove('glow-ring');
          },800);
        }

        setTimeout(newQuestion, 800);
      }else{
        streak=0; streakEl.textContent=streak;
        msgEl.className='row msg bad';
        const text = 'ØºÙ„Ø· Ø¨Ø³ÙŠØ·ØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
        msgEl.textContent = text;
        speak(text,'bad');
        playClickBad();
        const box = btn.querySelector('.box');
        box.style.transform='scale(0.95)';
        setTimeout(()=>box.style.transform='',160);
      }
    }

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø©
    newQuestion();
  </script>
</body>
</html>
